 \newcommand{\shuffle}{\,{{\sqcup}\hspace{-1.5pt}{\sqcup}}\,}
 \newcommand{\slang}{\mathtt{L}}
 \newcommand{\filter}[2]{#1_{\mid #2}}
\mkfun{\ssplit}{split}{}
\mkfun{\join}{join}{}
\mkfun{\subject}{subj}{}
\mkfun{\ssynch}{ss}{}
\mkfun{\dsynch}{ds}{}
\mkfun{\psynch}{ps}{}
\newcommand{\gasem}[1]{\asem{#1}_{\mathbf{U}}}
\newcommand{\commds}{\comm_{\!\mathsf{ds}}}
 \newcommand{\sclang}{sc-language }



We briefly recall a few notions used through the paper.
%
The sets of finite and infinite words on a given alphabet $\Sigma$ are,
respectively, denoted by $\Sigma^\star$ and $\Sigma^\omega$ (recall
that an infinite word, aka $\omega$-word~\cite{Staiger97}, on $\Sigma$
is a map from natural numbers to $\Sigma$).
%
Let $\_\cat\_$ be the concatenation operator on words and $\epsilon$
its neutral element.
%
We write $a_0 \cat a_1 \cat a_2 \cat \ldots$ for the word mapping $i$
to $a_i \in \Sigma$ for all natural numbers $i$.
%
A language $L$ on $\Sigma$ is a subset of $\Sigma^\infty$ where
$\Sigma^\infty = \Sigma^\star \cup \Sigma^\omega$.  The prefix-closure
of $L \subseteq \Sigma^\infty$ is
$\pref[L] = \Set{\aword \in \Sigma^\infty \sst \exists \aword' \in L
  \qst \aword \preceq \aword'}$, where $\preceq$ is the prefix
relation.
%
As usual we shall write $\aword\prec\aword'$ whenever
$\aword\preceq\aword'$ and $\aword\neq\aword'$.
%
Recall that $L \subseteq \Sigma^\infty$ is \emph{prefix-closed} if
$L = \pref[L]$.
%
A word $\aword$ is \emph{maximal} in a language
$L \subseteq \Sigma^\infty$ if whenever $\aword \preceq \aword'$ for
$\aword' \in L$ then $\aword' = \aword$.

We shall deal with languages on particular alphabets, namely the
alphabets of \emph{interactions} $\alfint$ and of \emph{actions}
$\alfact$, defined as follows\footnote{These sets may be infinite;
  formal languages over infinite alphabets have been studied, e.g.,
  in~\cite{ajb80}.}
%
%\footnote{Following customary notation, given
%  an alphabet $\Sigma$, $\Sigma^\star$ and $\Sigma^\omega$
%  respectively denote the set of finite and infinite words on
%  $\Sigma$; let $\Sigma^\infty = \Sigma^\star \cup \Sigma^\omega$ be
%  the $\omega$-words on $\Sigma$.
%  %
%  Also, $\prec$ is the prefix relation on words and
%  $\pref[L] = \Set{w \in \Sigma^\infty \sst \exists w' \in L \qst w
%	 \prec w'}$ is the prefix-closure of language $L \subseteq \Sigma^\infty$.
%  %
%  Recall that $L \subseteq \Sigma^\infty$ is \emph{prefix-closed} if
%  $L = \pref[L]$.
%  %
%} 
\begin{align*}
  \alfint & = \Set{\gint[] \sst \p \neq \q \in \mathfrak{P}, \msg \in \mathfrak{M}}
  & & \text{ranged over by $\aint, \aint[b], \ldots$}
  \\
  \alfact & = \Set{\aout, \ain \sst \ptp[A] \neq \ptp[B] \in \mathfrak{P}, \msg \in \mathfrak{M}}
  & & \text{ranged over by $\aact, \aact[b], \ldots$}
\end{align*}
%
where $\mathfrak{P}$ is a fixed set of \emph{participants} (or
\emph{roles}, ranged over by $\p$, $\ptp[B]$, etc.) and $\mathfrak{M}$
is a fixed set of \emph{messages} (ranged over by $\msg$, $\msg[x]$,
etc.); we take $\mathfrak{P}$ and $\mathfrak{M}$ disjoint.
%
Let $\msgof[\gint] = \msgof[\aout] = \msgof[\ain] = \msg$ and
% , $\sndint[\aint]$ its \emph{sender} \p, and $\rcvint[\aint]$ its \emph{receiver} \q; we set
$\ptpof[\gint] = \ptpof[\aout] = \ptpof[\ain] = \Set{\p,\q}$.
%
These functions extend homomorphically to (sets of) words.
%
The \emph{subject} of $\aout$ is the sender \p\ and the subject of
$\ain$ is the receiver \q.
%
Words on $\alfint^\infty$ (ranged over by $\acword,\acword',...$) are
called \emph{interaction words} while those on $\alfact^\infty$
(ranged over by $\aaword,\aaword',...$) are called \emph{words of
  actions}.
%
We let $\aword,\aword',...$ range over
$\alfint^\infty \cup \alfact^\infty$ and use $\clang$ and $\alang$ to
range over subsets of, respectively, $\alfint^\infty$ and
$\alfact^\infty$.

A \emph{global language} specifies the expected interactions of a
system while a \emph{local language} specifies the communication
behaviour of participants.

\begin{definition}[Global language]\label{def:chorlang}
  A \emph{global language} (\emph{g-language} for short) is a
  prefix-closed language $\clang$ on $\alfint^\infty$ such that
  $\ptpof[\clang]$ is finite.
\end{definition}

\begin{definition}[Local language]\label{def:actlang}
  A \emph{local language} (\emph{l-language} for short) is a
  prefix-closed language $\alang$ on $\alfact$ such that 
  $\ptpof[\alang]$ is finite.
  %
  An l-language is \emph{$\p$-local} if its words have all actions
  with subject \p.
\end{definition}

%
As discussed in \cref{sec:intro}, l-languages give rise to
\emph{communicating systems}.
\begin{definition}[Communicating system]\label{def:commSyst}
  Let $\ptpset \subseteq \mathfrak{P}$ be a finite set of
  participants.
  %
  A \emph{(communicating) system over $\ptpset$} is a map
  $\aCS = (\alang_{\p})_{\p \in \ptpset}$ assigning an $\p$-local
  language $\alang_{\p}\neq \Set{\epsilon}$ such that
  $\ptpof[\alang_{\p}] \subseteq \ptpset$ to each participant
  $\p \in \ptpset$.
\end{definition}



By projecting a g-language $\clang$ on a participant $\p$ we obtain
the $\p$-local language describing the sequence of actions performed
by $\p$ in the interactions involving $\p$ in the words of $\clang$.
\begin{definition}[Projection]\label{def:projection}
  The \emph{projection on \p} of an interaction $\gint[][B][@][C]$
  is computed by the function
  $\proj{\_}{\_} : \alfint \times \mathfrak{P} \to \alfact \cup \Set{\epsilon}$ defined by:
  \[
	 \proj{(\gint[])}{A} = \aout \qquad\qquad \proj{(\gint[])}{B} =
	 \ain \qquad\qquad \proj{(\gint[])}{c} = \epsilon
  \]
  %
  and extended homomorphically to interaction words and g-languages.
  %
  The \emph{projection of a g-language $\clang$}, written
  $\proj{\clang}{}$, is the communicating system
  $(\proj{\clang}{\p})_{\p \in \ptpof[\clang]}$.
\end{definition}
\cref{def:projection} recasts in our setting the notion of projection
used, e.g., in~\cite{CarboneHY12,honda16jacm}.



\begin{example}\label{ex:simple}\hfill\\
  Let
  $\clang = \Set{\emptyword,\, \gint[][A][m][D],\,\gint[][A][m][D]\cat\gint[][C][m][B],\, 
                                               \gint[][A][m][B],\, 
                                               \gint[][C][m][B],\,
                                               \gint[][C][m][B]\cat\gint[][A][m][D]}$

  $\proj{\clang}{} = (\proj{\clang}{X})_{\ptp[X] \in
	 \Set{\p,\q,\ptp[c],\ptp[d]}}$ where\\
  $\proj{\clang}{A} = \Set{\varepsilon,\, \aout[A][D],\, \aout[A][B]}$,\\
  $\proj{\clang}{B} = \Set{\varepsilon,\, \ain[C][B]}$, \\
  $\proj{\clang}{C} = \Set{\varepsilon,\, \aout[C][B]}$, and\\
  $\proj{\clang}{D} = \Set{\varepsilon,\, \ain[A][D]}$.
  \finex
\end{example}

\begin{definition}[Split and Join]\label{def:decomp}
\begin{enumerate}[i)]
\item
  The \emph{splitting} operation
  $\ssplit[\_]: \alfint^\infty \to \alfact^\infty$ 
  is the homomorphic extension on words and sets of words of the following function on interactions. 
  \[
	 \ssplit[\gint] = \aout\cat\ain
  \]
  \item
  The \emph{joining} operation on strict synchronous words of actions 
  is the homomorphic extension on words and sets of words of the following function on interactions. 
  \[
	 \join[\aout\cat\ain] = \gint
  \]
  \end{enumerate}
\end{definition}

We define an operation filtering out in an word of action those actions  having a given subject

\begin{definition}[Filtering]\label{def:decomp}
  The \emph{filtering} operation
  $\filter{\_}{\_}: \alfact^\infty \times \mathfrak{P} \to
  \alfint^\infty$ is the homomorphic extension on words of the following function on actions. 
  \[
	 \filter{\aact}{\p} =
	 \begin{cases}
		\aact &  \text{if } \p \text{ is the subject of } \aact
		\\
		\emptyword &  \text{otherwise}
	 \end{cases}
  \]
\end{definition}

\begin{fact}
\label{fac:joinsplit}
Let $\clang$ be a c-language, $\acword\in\clang$, $\aCS$ a communicating system on $\ptpset$, $\px\in\ptpset$, and let $z\in\alfact^\infty$ such that $\ssynch[z]$
\begin{enumerate}[i)]
\item
\label{fac:joinsplit-a}
$\filter{{\ssplit[{\acword}]}}{\px} = \proj{\acword}{X}$
\item
\label{fac:joinsplit-feqp}
$\proj{\join[z]}{X} = \filter{z}{\px}$. 

\end{enumerate}
\end{fact}



\subsection{Symmetric synchronous semantics}

We consider a \emph{synchronous} semantics of
communicating systems, similarly to other choreographic approaches
such as~\cite{BravettiZ07,CarboneHY12,Dezani-Ciancaglini16,SeveriD19}.

\begin{definition}[Symmetric synchronous Semantics]\label{def:syncSem}
  Given a system $\aCS$ on $\ptpset$, the set
  \[
	 \ssem{\aCS} = \Set{\acword \in \alfint^\infty \sst  \ptpof[\acword] \subseteq \ptpset \ \land\ \forall \p \in
		\ptpset \qst \ \proj{\acword}{\p} \in \aCS(\p)}
  \]
  is the \emph{{\bf symmetric} (synchronous) semantics} of $\aCS$;
\end{definition}

\subsection{Asymmetric synchronous semantics}

In the asymmetric case we can look at a syncronous communication of the message $\msg$
from $\p$ to $\q$ as composed by two actions: the choice of $\aout$ among the possible outputs and the
handshaking communication resulting in the reception of the message by $\q$ ($\ain$).
Of course several different actions performed by participants other that $\p$ and $\q$
could occur in between $\aout$ and $\ain$. The following definition describe the words
of actions that correspond to possible runs in a system with asymmetric synchronous communincations.
 

\begin{definition}[Deferred synchronous words]
Let $z\in\alfact^{\infty}$. We say $z$ to be a 
\begin{enumerate}
\item
{\em (WEAK?) deferred synchronous word} ($\dsynch[z]$) whenever both the following conditions hold
\begin{enumerate}[a)]
\item 
for each action $\aout$ in $z$, the first action after it of the form $\p\,\_!\_$ or  $\_\,\p?\_$ (if any) is $\ain$;
\item
for each action $\ain$ in $z$, the first action preceding it of the form $\p\,\_!\_$ or  $\_\,\p?\_$ is $\aout$, and it is always the case.
\end{enumerate}
We define $DS=\Set{z\in\alfact^\infty \sst \dsynch[z]}$.
\item
 {\em strictly synchronous} $(\ssynch[z])$ whenever there exist $z'\in\alfact^{\infty}$ and 
 $\acword\in\alfint^{\infty}$ such that 
   $z'=\ssplit[w]$ and $z\commds z'$.\\
   We define $SS=\Set{z\in\alfact^\infty \sst \ssynch[z]}$.
\end{enumerate}
\end{definition}





The following definition of asymmetric semantics for a communicating system $\aCS$ corresponds
to the possible runs (deferred synchronous words) of  $\aCS$.



\begin{definition}[Unrestricted asymmetric synchronous semantics]
 \[
	 \gasem{\aCS} = \Set{z \in \alfact^\infty \sst \dsynch[z] \land\ptpof[z] \subseteq \ptpset \ \land\ \forall \p \in
		\ptpset \qst \filter{z}{\p} \in \aCS(\p)  }
  \]
  is the \emph{{\bf unrestricted asymmetric} (synchronous) semantics} of $\aCS$;
\end{definition}

Notice that we need to consider only elements of $DS$, otherwise the semantics of a system like
$\aCS = ({\alang}_{\px})_{\ptp[X] \in \Set{\p,\q}}$ where\\
\centerline{$\alang_{\p}= \Set{\aout[A][B][][m]}$ \qquad $\alang_{\q}= \Set{\ain[A][B][][m]^\omega}$ }
would contain also runs like 
$\aout[A][B][][m]\cat\ain[A][B][][m]^\omega$ or $\ain[A][B][]\cat\aout[A][B][][m]$, which are trivially nonsensical for the intended synchronous interactions.


We now notice that, in presence of infinite computations and unless strong restrictions on systems are imposed, 
equivalences of semantics would not be possible.
Let us consider the system
$\aCS = ({\alang}_{\px})_{\ptp[X] \in \Set{\p,\q, \ptp[C], \ptp[D]}}$ where
$$\begin{array}{ll}
\alang_{\p}= \pref[\Set{(\aout[A][B][][m])^\omega}] &
\alang_{\q}= \pref{\Set{(\ain[A][B][][m])^\omega}}  \\[2mm]
\alang_{\ptp[C]}= \Set{\emptyword, \aout[C][D][][m]} &
\alang_{\ptp[D]}= \Set{\emptyword,\ain[C][D][][m]}
\end{array}$$
We have that 
$\ssem{\aCS} = 
\Set{(\gint[][A][m][B])^h\cat\gint[][C][m][D]\cat(\gint[][A][m][B])^k \sst h,k\geq 0}\cup\pref[\Set{(\gint[][A][m][B])^\infty}]$.
Moreover, it is possible to check that 
$z = \aout[A][B][][m]\cat\aout[C][D][][m]\cat\ain[A][B][][m]\cat(\aout[A][B][][m]\cat\ain[A][B][][m])^\omega\in\gasem{\aCS}$, where $z$ is maximal in $\gasem{\aCS}$ and  $\aout[C][D][][m]$ is unmatched in $z$.
The presence of the unmatched $\aout[C][D][][m]$ in $z$ is however only due to the lack
of fairness towards the participant $\ptp[D]$, since in the semantics it is also present
a maximal $z'$ which correspond precisely to $z$ but for the presence of the matching
action for the $\aout[C][D][][m]$. More precisely, we have
that also  $z' = \aout[A][B][][m]\cat\aout[C][D][][m]\cat\ain[C][D][][m]\cat\ain[A][B][][m]\cat(\aout[A][B][][m]\cat\ain[A][B][][m])^\omega\in\gasem{\aCS}$.
It is reasonable not to take into account, when checking the equivalence, words like $z$.





The above unrestricted semantics could be, however, not comfortably handled.
We then restrict it to a sound subset that safely \quo{represents} it. 
The following observation is at the basis of what will shall use as the 
actual asymmetric synchronous semantics (\cref{def:syncSem} below)

Let us consider a generic trace $z$ of a system with asymmetric synchronous communication possibly
containing a number of output actions which have not been \quo{matched} yet by their corresponding
input actions. It is not difficult to see that we can rearrange the actions of $z$ in a \quo{consistent} way, in order to obtain another word belonging to the semantics and of the form
$\hat z\cat z'$, where $z'$ contains only the unmatched output and in $\hat z$ each
output is immediately followed by the corresponding input.


\begin{definition}[(prefix/strict) synchronous words]
% We say that $\aact[a]\cat\aact[b]\in\alfact^2$ is a split-pair of action
%  whenever $\aact[a]=\aout$ implies $\ain$.
%  
  A word of actions $z\in\alfact^{\infty}$ is 
  \begin{enumerate}[i)]
  \item
  {\em strictly synchronous} $(\ssynch[z])$ whenever
   $z=\ssplit[w]$ for some $\acword\in\alfint^\infty$.
  \item
  {\em prefix synchronous} $(\psynch[z])$ whenever
  \begin{description} 
  \item
  If $z\in\alfact^{*}$ then $z=z'\cat o$ where $\ssynch[z']$ and $o$ is a word of output actions;
  \item
  If $z\in\alfact^{\omega}$ then there exists a finite word $o$ of output actions  such that 
  $\ssynch[{z\setminus o}]$
  \end{description}
\end{enumerate}
  $\slang\subseteq \alfact^{\infty}$  is a \emph{strictly ({\text{resp.} prefix) synchronous} language
  of actions} (\emph{ss-(ps-)language} for short) whenever each word in $\slang$ is strictly (resp. prefix) synchronous.
  \end{definition}
  
  We define a relation on deferred synchronous words.
\begin{definition}[$\commds$]
The relation $\commds\ \subseteq DS{\times}DS$ is defined by
$$z\commds z'  \quad \text{if} \quad \forall \px.\ \filter{z}{\px}=\filter{z}{\px}$$
\end{definition}

  
\begin{lemma}
Let be $\aCS$ a communicating system.
\begin{enumerate}[i)]
\item
Given $z\in \gasem{\aCS}$, there exists $z'\commds z$ such that $\psynch[z']$ and $z'\in \gasem{\aCS}$.
\item
$\gasem{\aCS}$ is $\commds$-closed.
\end{enumerate}
\end{lemma}
 
We can hence safely provide a more manageable definition of asymmetric synchronous semantics. 
\begin{definition}[Asymmetric synchronous Semantics]\label{def:syncSem}
  Given a system $\aCS$ on $\ptpset$, the set
  \[
	 \asem{\aCS} = \Set{z \in \alfact^\infty \sst \ptpof[z] \subseteq \ptpset \ \land\ \psynch[z]\  \land\ \forall \p \in
		\ptpset \qst \filter{z}{\p} \in \aCS(\p)  }
  \]
  is the \emph{{\bf asymmetric} (synchronous) semantics} of $\aCS$;
\end{definition}

\begin{lemma}
Let $\aCS$ be a system on $\ptpset$.
$$\gasem{\aCS} = \Set{z\in\alfact^\infty \sst  \psynch[z] \land \exists z'\in\asem{\aCS}.\  z\commds z'}$$ 
\end{lemma}

[say that the two semantics are a g- and an s-language, that is they are prefix-closed]

\begin{lemma}
\label{fac:asymmsubsymm}
Let  $\aCS$ be a communicating system on $\ptpset$.
\begin{enumerate}[i)]
\item
$\ssem{\aCS} =  
\Set{\acword \in \alfint^\infty \sst  
\ptpof[\acword] \subseteq \ptpset \ \land\ \forall \p \in \ptpset \qst \filter{\ssplit[\acword]}{\p} \in \aCS(\p)}$.
\item
\label{fac:asymmsubsymm-aimps}
$z\in\asem{\aCS}$ and $\ssynch[z]$ implies $\join[z]\in\ssem{\aCS}$.
\item
\label{fac:asymmsubsymm-asubs}
$\pref[{\ssplit[{\ssem{\aCS}}]}] \subseteq \asem{\aCS}$.
\end{enumerate}
\end{lemma}

\begin{example}
\label{ex:simple2}
The two semantics are trivially non equivalent in general on communicating systems.
Let us consider $\aCS = ({\alang}_{\px})_{\ptp[X] \in \Set{\p,\q}}$ where\\
\centerline{$\alang_{\p}= \Set{\aout[A][B][][m], \aout[A][B][][y]}$ \qquad $\alang_{\q}= \Set{\ain[A][B][][m]}$ }
is clearly lock-free with the symmetric semantics and non lock-free with the asymmetric one.

 Even in case we consider systems
obtained by projecting a CUI \sclang the two semantics can differ. 
Let us consider the \sclang $\clang$ in \cref{ex:simple}.
$\clang$ is CUI, hence we have 
  $$\ssem{\proj{\clang}{}} = \clang$$ 
whereas 
  $$\asem{\proj{\clang}{}} = \ssplit[\clang] \cup \pref[\Set{\aout[A][B][][m]\cat\ain[A][B][][m]\cat\aout[C][B][][m]}]$$
\finex
\end{example} 

\begin{definition}[Asymm-synchronous correctness and completeness]\label{def:cc}
  Let $\aCS$ be a communicating system and $\clang$ a g-language.\\
  $\aCS$ is \emph{a-synch correct (resp. complete) with respect to
    $\clang$} if $\join[{\asem{\aCS}}]\subseteq \clang$ (resp. 
  $\join[{\asem{\aCS}}]\supseteq \clang$).
\end{definition}


\begin{definition}[CUIasym]
\label{def:cuiasym}
A c-language $\clang$ on $\ptpset$ is CUIasym $(\cuuiasym[\clang])$ whenever,
 for each $\p,\q\in\ptpset$ and $\acword, \acword_1\in\clang$, the following holds:\\
 \centerline{$\proj{\acword}{A} = \proj{\acword_1}{A}\ \land\  \proj{\acword}{B} = \proj{\acword_2}{B}\ \land\  \acword_1\cat\gint\in\clang\ \implies\ \acword\cat\gint\in\clang$}
\end{definition}

\begin{proposition}
Let $\clang$ be a g-language.\\
\centerline{$\cuuiasym[{\clang}]\ \implies\ \cuui[\clang]$}
\end{proposition}
\begin{proof}
Let us assume $\cuuiasym[{\clang}]$ to hold. In order to show  $\cuui[{\clang}]$, 
by definition let us consider $\acword_1,\acword_2,\acword\in\clang$, $\p,\q,\msg$ such that
$$\proj{\acword}{A} =\proj{\acword_1}{A}\quad \proj{\acword}{B} =\proj{\acword_1}{B}
\quad \acword_1\cat\gint, \acword_2\cat\gint\in\clang$$
From $\proj{\acword}{A} =\proj{\acword_1}{A}$ and $\acword_1\cat\gint\in\clang$,
by $\cuuiasym[{\clang}]$ we immediately get  $\acword\cat\gint\in\clang$, that is what we needed to
prove $\cuui[\clang]$.
\qed
\end{proof}


\begin{theorem}[Equivalence of semantics]
\label{th:eqsem}
 Let $\clang$ be a CUI \sclang\!.
$$
\cuuiasym[\clang] \quad \text{iff}\quad \asem{\proj{\clang}{}} =  \pref[{\ssplit[\ssem{\proj{\clang}{}}]}]\quad (=
 \pref[{\ssplit[\clang]}] \text{ by } \cuui)
$$
\end{theorem}
\begin{proof}
%
($\Leftarrow$).
%
By contraposition, let us assume $\cuuiasym[\clang]$ not to hold. In that case, by \cref{def:cuiasym}, 
it has to be the case that
there exists $\p,\q\in\ptpset$ and $\acword, \acword_1\in\clang$ such that
\begin{equation}
\label{eq:lahyp}
 \proj{\acword}{A} = \proj{\acword_1}{A}\ \land\  \acword_1\cat\gint\in\clang\ \land\ \acword\cat\gint\not\in\clang
 \end{equation}
 This necessarily implies $\acword_1\neq\acword$.
We now observe that, by definition of projection, trivially,
 $\proj{(\acword_1\cat\gint)}{A}\in{\proj{\clang}{A}}$.
 So, using  Fact \ref{fac:joinsplit}(\ref{fac:joinsplit-a}) and the above, we have that
 $\proj{(\acword_1\cat\gint)}{A}
= \proj{\acword_1}{A}\cat\aout[A][B][][m]
= \proj{\acword}{A}\cat\aout[A][B][][m]
 = \filter{(\ssplit[{\acword}])}{\p}\cat\aout[A][B][][m]
 = \filter{(\ssplit[{\acword}]\cat\aout[A][B][][m])}{\p}
 \in{\proj{\clang}{A}}$.
 Now, by  definitions of projection, filtering and by Fact \ref{fac:joinsplit}(\ref{fac:joinsplit-a}) we have that, for each $\px\neq\p$, $\filter{(\ssplit[{\acword}]\cat\aout[A][B][][m])}{\px}=\filter{\ssplit[{\acword}]}{\px}=\proj{{\acword}}{\px}\in\proj{\clang}{X}$.
So, by definition of $\asem{\proj{\clang}{}}$ and by observing that, trivially,
$\psynch[{\ssplit[{\acword}]\cat\aout[A][B][][m]}]$, we get 
 $$\ssplit[{\acword}]\cat\aout[A][B][][m]\in\asem{\proj{\clang}{}}.$$
 In order to get the thesis it is then enough to show that 
 $$\ssplit[{\acword}]\cat\aout[A][B][][m] \not\in\pref[{\ssplit[\ssem{\proj{\clang}{}}]}].$$ 
 This means that we have to show that for no $u\in\alfact^\infty$ such that
 $\ssynch[{\ssplit[{\acword}]\cat\aout[A][B][][m]\cat u}]$
 we have $\join[{\ssplit[{\acword}]\cat\aout[A][B][][m]\cat u}]\in\ssem{\proj{\clang}{}}$. 
 If there were such an $u$, it should have necessarily the form $u=\ain[A][B][][m]\cat u'$.
 This, by prefix closure of $\ssem{\proj{\clang}{}}$, would imply
$\join[{\ssplit[{\acword}]\cat\aout[A][B][][m]\cat \ain[A][B][][m]}]\in\ssem{\proj{\clang}{}}$,
that is $\acword\cat\gint\in\ssem{\proj{\clang}{}}$ and hence, by $\cuui$,
$\acword\cat\gint\in{{\clang}}$, contradicting the third conjunct of (\ref{eq:lahyp}).\\
%
 ($\Rightarrow$).
 %
 We assume $\cuuiasym$. Now, to show the thesis by contradiction, we assume 
 $\asem{\proj{\clang}{}}$ not to be equivalent to $\ssem{\proj{\clang}{}}$.
 In such a case, by \cref{fac:asymmsubsymm}( \ref{fac:asymmsubsymm-asubs}),
 one of the two following possibilities can occur.
 \begin{enumerate}[a)]
 \item
 There exits $z\in \asem{\proj{\clang}{}}$ such that $z\in \alfact^*$, $z$ is maximal in 
 $\asem{\proj{\clang}{}}$ and $\neg\ssynch[z]$.
 
 \end{enumerate}
 
 
 
 
 
 
 
 
 
 
 
 \begin{equation}
 \label{eq:aneqs}
 \asem{\proj{\clang}{}} \neq  \pref[{\ssplit[\ssem{\proj{\clang}{}}]}].
 \end{equation}
 Since, by \cref{fac:asymmsubsymm}( \ref{fac:asymmsubsymm-asubs}),
 $\pref[{\ssplit[{\ssem{\proj{\clang}{}}}]}] \subseteq \asem{\proj{\clang}{}}$
 we have that our assumption (\ref{eq:aneqs}) correspond to 
 $\asem{\proj{\clang}{}}\not\subseteq \pref[{\ssplit[{\ssem{\proj{\clang}{}}}]}]$.
 By \cref{fac:asymmsubsymm}(\ref{fac:asymmsubsymm-aimps}) this in turn corresponds to
 asserting that the set 
 $$
 I = \Set{z\in\asem{\proj{\clang}{}} \sst \neg\ssynch[{z}] \land 
 \forall \hat\acword\in\ssem{\proj{\clang}{}}.\ z\not\preceq \ssplit[{\hat w}]}$$
 is non empty.
 
 
 ==============================
 
 
 This implies that, for certain $\hat z \in\alfact^*$ and $\p,\q,\msg[m]$, $z$ is of the form $z=\hat z\cat\aout$ and such that
 \begin{equation}
 \label{eq:negass}
% \exists \hat z \in\alfact^\infty \ssynch[\hat z]\ \land\ \exists \p,\q,\msg[m].\  \hat z\cat\aout \in \asem{\proj{\clang}{}} \land\  
 \join[{\hat z\cat\aout\cat\ain}]\not\in\ssem{\proj{\clang}{}}
 \end{equation}
 In fact, if we had  $\join[{\hat z\cat\aout\cat\ain}]\in\ssem{\proj{\clang}{}}$
 we would also have $\join[{\hat z\cat\aout\cat\ain}]\in\ssem{\proj{\clang}{}}$
 
 
 By definition of $\asem{\proj{\clang}{}}$, 
for each $\px\in\ptpof[\hat z\cat\aout]$  there is a $z_{\px}\in\proj{\clang}{X}$ such that
$\filter{(\hat z\cat\aout)}{\px}=z_{\px}$. In particular, $z_{\p}= \filter{\hat z}{\p}\cat\aout$ and,
for  $\px\neq\p$, $\filter{\hat z}{\px}=z_{\px}$.
Now, by definition of projection,  for each $\px\in\ptpof[z]$ we can set $\acword_{\px}\in\clang$
as a word such that  $\proj{\acword_{\px}}{X}= z_{\px}$. 
Since $z_{\p}= \filter{\hat z}{\p}\cat\aout$, we can infer that  
$\acword_{\p}= \acword_1\cat\gint$ for some $\acword_1\in\clang$ such that
$\proj{\acword_1}{A}= \filter{\hat z}{\p}$. 
 
 We now observe that  $\asem{\proj{\clang}{}}$ is prefix closed, 
so $\hat z\in \asem{\proj{\clang}{}}$. 
Hence, by $ \ssynch[\hat z]$ and  
\cref{fac:asymmsubsymm}(\ref{fac:asymmsubsymm-aimps}), 
$\join[\hat z]\in\ssem{\proj{\clang}{}}$. Then,
since $\clang$ is CUI, we get $\join[\hat z]\in\clang$. 
Moreover, by Fact \ref{fac:joinsplit}(\ref{fac:joinsplit-feqp}) for each $\px$,
$\proj{\join[\hat z]}{X}=\filter{\hat z}{\px}$. 
We now proceed by noticing that $\acword_1\neq\join[\hat z]$. In fact, otherwise, we would have $\join[\hat z]\cat\gint\in\clang$
and hence, by $\cuui$, 
${\join[\hat z]}\cat\gint\in\ssem{\proj{\clang}{}}$, 
that is $\join[{\hat z\cat\aout\cat\ain}]\in\ssem{\proj{\clang}{}}$,
contradicting the third conjunct of our assumption (\ref{eq:negass}).\\
 Now, by setting $\acword=\join[\hat z]$, by the above
we have that
\begin{itemize}
\item
$\proj{\acword_1}{A} = \proj{\acword}{A}$\qquad 
(since $\proj{\acword_1}{A}=\filter{\hat z}{\p}=\proj{\join[\hat z]}{A}=\acword$)
%\item 
%$\proj{\acword_2}{B} = \proj{\acword}{B}$
\item
$\acword_1\cat\gint\in\clang$
\end{itemize} 
So, by $\cuuiasym[\clang]$, $\acword\cat\gint=\join[\hat z]\cat\gint\in\clang$. 
This, as previously shown, would imply  $\join[{\hat z\cat\aout\cat\ain}]\in\ssem{\proj{\clang}{}}$ that contradicts the third conjunct of (\ref{eq:negass}).
\qed
 \end{proof}
 
 \begin{example}
In \cref{ex:simple2} we have seen that the two synchronous semantics differ on the \sclang 
$\clang$ of \cref{ex:simple}.
In fact it is possible to show that $\cuuiasym[{\clang}]$ does to hold.
By taking $\acword_1=\gint[][A][m][D]$ and $\acword=\gint[][A][m][B]$, we have that
$$\proj{\acword_1}{C}=\emptyword = \proj{\acword}{C} \quad\text{ and }\quad \acword_1\cat\gint[][C][m][B]\in\clang$$
However $\gint[][A][m][B]\cat\cat\gint[][C][m][B]= \acword\cat\cat\gint[][C][m][B]\not\in\clang$.
\finex
\end{example}

 
 It is easy to show that in the  characterization of \cref{th:eqsem}  one cannot get rid of the CUI hypothesis.
 In fact, for $\clang=\Set{\gint[][A][m][B], \gint[][C][m][D]}$, the two semantics are
 trivially equivalent on $\proj{\clang}{}$ and $\cuui[\clang]$ does not hold.
 In any case, a chracterisation of the equivalence for c-languages that could be non CUI,
 would hardly be of any use.
 

 
% ========================
% 
%By definition of semantics (\cref{def:syncSem}), it is enough to show that 
%the set
%$$
%Y = \Set{\hat u   \sst \ssynch[\hat u]\ \land\ \exists \p,\q,\msg[m].\  \hat u\cat\aout \in \asem{\proj{\clang}{}} \land\  \join[{\hat u\cat\aout\cat\ain}]\in\ssem{\proj{\clang}{}} }
%$$
%is empty.
%By contradiction let us assume $Y$ not to be empty.
%We can then take a word $\hat z\in Y$, namely such that $\ssynch[\hat z]$,
%$\hat z\cat\aout\in \asem{\proj{\clang}{}}$ but $\hat z\cat\aout\cat\ain\not\in\asem{\proj{\clang}{}}$.
%By definition of $\asem{\proj{\clang}{}}$, 
%for each $\px\in\ptpof[\hat z\cat\aout]\subseteq\ptpset$  there is a $z_{\px}\in\proj{\clang}{X}\cap\alfact^*$ such that
%$\filter{(\hat z\cat\aout)}{\px}=z_{\px}$. In particular, $z_{\p}= \hat z'_{\p}\cat\aout$ 
%for some $\hat z'_{\p}$ and, if $\px\neq\p$, $\filter{\hat z}{\px}=z_{\px}$.
%Now, by definition of projection,  for each $\px\in\ptpof[z]$ we can set $\acword_{\px}\in\clang$
%as a word such that  $\proj{\acword_{\px}}{X}= z_{\px}$. 
%Since $z_{\p}= \hat z'_{\p}\cat\aout$, we can infer that  
%$\acword_{\p}= \acword_1\cat\gint$ for some $\acword_1\in\clang$ such that
%$\proj{\acword_1}{A}= \hat z'_{\p}$. 
%
%We now observe that  $\asem{\proj{\clang}{}}$ is prefix closed, 
%so $\hat z\in \asem{\proj{\clang}{}}$. 
%Hence, by Fact \ref{fac:asymmsubsymm}, $\join[\hat z]\in\ssem{\proj{\clang}{}}$ and then,
%since $\clang$ is CUI, we get $\join[\hat z]\in\clang$. 
%Moreover, for $\px\neq\p$,
%$\proj{\join[\hat z]}{X}=\filter{\hat z]}{\px}$. 
%%So, in particular $\proj{\join[\hat z]}{B}=\filter{\hat z}{\q}=z_{\q}=\proj{\acword_{\q}}{B}$.
%We notice that $\acword_1\neq\join[\hat z]$. In fact, otherwise, we would have $\join[\hat z]\cat\gint\in\clang$
%and hence, by $\cuui$ and Fact \ref{fac:asymmsubsymm}, $\ssplit[{{\join[\hat z]}\cat\gint}]\in\asem{\proj{\clang}{}}$, that is $\hat z\cat\aout\cat\ain\in\asem{\proj{\clang}{}}$,
%contradicting what we had assumed. 
%
%
%
%
%Now, by setting $\acword=\join[\hat z]$ % and $\acword_2=\acword_{\q}$
%we have that
%\begin{itemize}
%\item
%$\proj{\acword_1}{A} = \proj{\acword}{A}$
%%\item 
%%$\proj{\acword_2}{B} = \proj{\acword}{B}$
%\item
%$\acword_1\cat\gint\in\clang$
%\end{itemize} 
%So, by CUI2, $\acword\cat\gint\in\clang$. 
%This, as shown above, would imply by definition implies $\hat z\cat\aout\cat\ain\in\asem{\proj{\clang}{}}$, so contradicting that $\hat z\in Y$.
%\qed
%
%Let us now consider $\hat z=\aact[a]_0\cat\ldots\cat\aact[a]_{n-1}$. By definition it follows that
%$\hat z \in \ssem{\proj{\clang}{}}$. 
%Moreover, for each $\px\in\ptpof[z]\subseteq\ptpset$  there is a
%subsequence $z_{\px}$ of $\hat z$ of the form $\aact[a]_{j_{\px}0}\cat\ldots\cat\aact[a]_{j_{\px}m_{\px}}$ belonging to $\proj{\clang}{X}$ such that $\hat z \in \shuffle_{\ptpof[z]}z_{\px}$.
%
%For each $\px\in\ptpof[z]$ let now $\acword_{\px}\in\clang$ be a word such that $\proj{\acword}{X}= z_{\px}$. 
%By definition of projection it follows that $\acword_{\p}$ has the form $\acword'\cat\gint$ 
%for some $\acword'$.
%By Lemma XXX 
% This immediately implies that $\acword_{\q}$ has the form $\acword''\cat\gint$ for some $\acword''$.
% 
% 
%
%Let now be $\acword = \acword_1\cat\gint$ the word in \\
%$(\subseteq)$



\begin{corollary}
Let $\clang$ be a CUIasym g-language. Then $\proj{\clang}{}$ is a-synch correct and complete for $\clang$.
\end{corollary}


It is now possible to show that if we consider the calculus of MultiParty Sessions of [DezaniSeveri]
(restricted to sequential reductions), on any system obtained by projecting a well-formed 
global types the two synchronous semantics are equivalent.


\begin{proposition}
For each global type ${\mathsf G}$,\\
\centerline{${\mathsf G}$ well-formed\ $\implies$\ $\cuuiasym[{\clang({\mathsf G})}]$.}
\end{proposition}

\begin{proof}
Let ${\mathsf G}$ be well-formed.
By contradiction, let us assume $\cuuiasym[{\clang({\mathsf G})}]$ not to hold.
This means that there exist $\acword_1,\acword\in\clang({\mathsf G})$ such that, for a certain
interaction $\gint$,
$$
\proj{\acword_1}{A} = \proj{\acword}{A}      \qquad      \acword_1\cat\gint\in\clang({\mathsf G})   
\qquad \acword\cat\gint\not\in\clang({\mathsf G})
$$
By well-formedness, each continuation of $\acword$ must contain an interaction with participant $\p$.
Let us then consider $\acword$ with one of its  continuation that is a word of the form
$$
\acword\cat\acword'\cat \aint \qquad \text{where } \p\in\ptpof[\aint] \quad \text{and }\proj{\acword'}{A}=\emptyword
$$
Now, since each participant has to distinguish each pair of maximal branches by two inputs,
we have necessarily that $\aint=\gint$. Moreover, since  $\proj{\acword'}{A}=\emptyword$,
also $\acword\cat \aint\cat\acword'\in\clang({\mathsf G}) $, contradicting our assumption
$\acword\cat\gint\not\in\clang({\mathsf G})$
\qed
\end{proof}


%\begin{proposition}[FALSE]
%Let $\clang$ be a  g-language. 
%$$\cuuiasym[\clang] \implies ba[\clang]$$
%\end{proposition}
%\begin{proof}
%Let us assume $\cuuiasym[\clang]$. By contradiction, let us assume also $ba[\clang]$ not to hold.
%So, by definition, we have two maximal words $\acword_1, \acword_2\in\clang$ and a participant
%$\p$ such that $\proj{\acword_1}{A}\prec \proj{\acword_2}{A}$.
%Let now $\hat\acword_1$ and $\hat\acword_2$ be the longest prefixes of, respectively
%$\acword_1$ and  $\acword_2$ such that $\proj{\hat\acword_1}{A}= \proj{\hat\acword_2}{A}$.
%Since $\proj{\acword_1}{A}\prec \proj{\acword_2}{A}$ there exists a prefix of $\acword_2$ 
%of the form $\hat\acword_2\hat\acword'_2\cat\gint$, 
%where $\proj{\hat\acword'_2}{A}=\emptyword$. 
%Since $\proj{\hat\acword_2\hat\acword'_2}{A}=\proj{\hat\acword_1}{A}$
%\end{proof}


[Deadlock Freeness in the asymmetric case cannot be formalised as in the symmetric one.]


Two interactions $\aint$ and $\aint[b]$ are \emph{independent} (in
symbols $\intpar$)
when % their sets of participants are disjoint, namely
$\ptpof[\aint] \cap \ptpof[{\aint[b]}] = \emptyset$.
%
Informally, a g-language is \emph{concurrency closed} when
\quo{independent} interactions can be swapped.
%
The concurrency closure on infinite words is delicate.
%
One in fact has to allow infinitely many swaps while avoiding that
they make an interaction disappear by \quo{pushing it infinitely
  down}.
%
Technically, we consider Mazurkiewicz's traces~\cite{maz86} on
$\alfint$ with independence relation $\intpar$:
\begin{definition}[Concurrency closure]\label{def:cc}
  Let $\comm$ be the reflexive and transitive closure of the relation
  $\equiv$ on finite interaction words defined by
  $\acword\,\aint\,\aint[b]\,\acword' \equiv
  \acword\,\aint[b]\,\aint\,\acword'$ where $\intpar$.
  %
  Following \emph{\cite[Def. 2.1]{Gastin90}}, $\comm$ extends to
  $\alfint^\omega$ by letting $\acword,\acword'\in\alfint^\omega$ and defining
  \[
	 \acword \comm\acword' \quad\iff\quad \acword \ll\acword' \qand \acword' \ll\acword
  \]
  %
  where
  $\acword \ll \acword'$ iff for each finite prefix $\acword_1$ of
  $\acword$ there are a finite prefix $\acword_1'$ of $\acword'$ and a
  g-word $\hat \acword \in \alfint^\star$ such that
  $\acword_1 \cat \hat \acword \comm \acword_1'$.
  %
  A g-language $\clang$ is \emph{concurrency closed} (c-closed for
  short) if it coincides with its concurrency closure, namely
  $\clang = \Set{\acword \in \alfint^\infty \sst \exists
	 \acword'\in\clang \qst \acword \comm \acword'}$.
\end{definition}

Semantics of systems are naturally c-closed since in a distributed setting
independent events can occur in any order.
%
Indeed
\begin{toappendix}
The relation $\comm$ can be characterised as follows.
  \begin{lemma}\label{lemma:equalProj}
  Given a g-language $\clang$ and two words
  $\acword_1, \acword_2 \in \clang$, $\acword_1 \comm \acword_2$ iff
  $\proj{\acword_1}{\p} = \proj{\acword_2}{\p}$ for each
  $\p \in \ptpof[\clang]$.
\end{lemma}
%\equalProj*
\end{toappendix}
\begin{appendixproof}
  This follows directly from~\cite[Proposition 2.2]{Gastin90}.
  \qed
\end{appendixproof}

\begin{restatable}{proposition}{ccsem}\label{prop:par}
  Let $\aCS$ be a system. Then $\ssem{\aCS}$ is
  c-closed.
\end{restatable}
\begin{toappendix}
  \ccsem*
\end{toappendix}
\begin{appendixproof}
  Trivial, since closure under swap does not change the projection by
  \cref{lemma:equalProj}.
  \qed
\end{appendixproof}

% \paragraph*{The ($\proj{(\_)}{}$,$\ssem{\_}$) Galois connection\footnote{We thank an anonymous referee for the introduction of this paragraph.}}



%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% TeX-master: "main"
%%% TeX-master: "main"
%%% End:
