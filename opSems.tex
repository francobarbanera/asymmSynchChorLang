 \newcommand{\shuffle}{\,{{\sqcup}\hspace{-1.5pt}{\sqcup}}\,}
 \newcommand{\slang}{\mathtt{L}}
 \newcommand{\filter}[2]{{#1}_{\mid #2}}
\mkfun{\ssplit}{split}{}
\mkfun{\join}{join}{}
\mkfun{\subject}{subj}{}
\mkfun{\ssynch}{ss}{}
\mkfun{\dsynch}{ws}{}
\mkfun{\wsynch}{ws}{}
\mkfun{\psynch}{ps}{}
\mkfun{\ba}{ba}{}
\mkfun{\sind}{sem-ind}{}
\mkfun{\unmatched}{{\footnotesize UnM}}{}
\newcommand{\gasem}[1]{\asem{#1}_{\mathbf{U}}}
\newcommand{\commds}{\comm_{\!\mathsf{ws}}}
\newcommand{\commws}{\comm_{\!\mathsf{ws}}}
 \newcommand{\sclang}{{sc-language}}



We briefly recall a few notions used through the paper.
%
The sets of finite and infinite words on a given alphabet $\Sigma$ are,
respectively, denoted by $\Sigma^\star$ and $\Sigma^\omega$ (recall
that an infinite word, aka $\omega$-word~\cite{Staiger97}, on $\Sigma$
is a map from natural numbers to $\Sigma$).
%
Let $\_\cat\_$ be the concatenation operator on words and $\epsilon$
its neutral element.
%
We write $a_0 \cat a_1 \cat a_2 \cat \ldots$ for the word mapping $i$
to $a_i \in \Sigma$ for all natural numbers $i$.
%
A language $L$ on $\Sigma$ is a subset of $\Sigma^\infty$ where
$\Sigma^\infty = \Sigma^\star \cup \Sigma^\omega$.  The prefix-closure
of $L \subseteq \Sigma^\infty$ is
$\pref[L] = \Set{\aword \in \Sigma^\infty \sst \exists \aword' \in L
  \qst \aword \preceq \aword'}$, where $\preceq$ is the prefix
relation.
%
As usual we shall write $\aword\prec\aword'$ whenever
$\aword\preceq\aword'$ and $\aword\neq\aword'$.
%
Recall that $L \subseteq \Sigma^\infty$ is \emph{prefix-closed} if
$L = \pref[L]$.
%
A word $\aword$ is \emph{maximal} in a language
$L \subseteq \Sigma^\infty$ if whenever $\aword \preceq \aword'$ for
$\aword' \in L$ then $\aword' = \aword$.

We shall deal with languages on particular alphabets, namely the
alphabets of \emph{interactions} $\alfint$ and of \emph{actions}
$\alfact$, defined as follows\footnote{These sets may be infinite;
  formal languages over infinite alphabets have been studied, e.g.,
  in~\cite{ajb80}.}
%
%\footnote{Following customary notation, given
%  an alphabet $\Sigma$, $\Sigma^\star$ and $\Sigma^\omega$
%  respectively denote the set of finite and infinite words on
%  $\Sigma$; let $\Sigma^\infty = \Sigma^\star \cup \Sigma^\omega$ be
%  the $\omega$-words on $\Sigma$.
%  %
%  Also, $\prec$ is the prefix relation on words and
%  $\pref[L] = \Set{w \in \Sigma^\infty \sst \exists w' \in L \qst w
%	 \prec w'}$ is the prefix-closure of language $L \subseteq \Sigma^\infty$.
%  %
%  Recall that $L \subseteq \Sigma^\infty$ is \emph{prefix-closed} if
%  $L = \pref[L]$.
%  %
%} 
\begin{align*}
  \alfint & = \Set{\gint[] \sst \p \neq \q \in \mathfrak{P}, \msg \in \mathfrak{M}}
  & & \text{ranged over by $\aint, \aint[b], \ldots$}
  \\
  \alfact & = \Set{\aout, \ain \sst \ptp[A] \neq \ptp[B] \in \mathfrak{P}, \msg \in \mathfrak{M}}
  & & \text{ranged over by $\aact, \aact[b], \ldots$}
\end{align*}
%
where $\mathfrak{P}$ is a fixed set of \emph{participants} (or
\emph{roles}, ranged over by $\p$, $\ptp[B]$, etc.) and $\mathfrak{M}$
is a fixed set of \emph{messages} (ranged over by $\msg$, $\msg[x]$,
etc.); we take $\mathfrak{P}$ and $\mathfrak{M}$ disjoint.
%
Let $\msgof[\gint] = \msgof[\aout] = \msgof[\ain] = \msg$ and
% , $\sndint[\aint]$ its \emph{sender} \p, and $\rcvint[\aint]$ its \emph{receiver} \q; we set
$\ptpof[\gint] = \ptpof[\aout] = \ptpof[\ain] = \Set{\p,\q}$.
%
These functions extend homomorphically to (sets of) words.
%
The \emph{subject} of $\aout$ is the sender \p\ and the subject of
$\ain$ is the receiver \q.
%
Words on $\alfint^\infty$ (ranged over by $\acword,\acword',...$) are
called \emph{interaction words} while those on $\alfact^\infty$
(ranged over by $\aaword,\aaword',...$) are called \emph{words of
  actions}.
%
We let $\aword,\aword',...$ range over
$\alfint^\infty \cup \alfact^\infty$ and use $\clang$ and $\alang$ to
range over subsets of, respectively, $\alfint^\infty$ and
$\alfact^\infty$.

A \emph{global language} specifies the expected interactions of a
system while a \emph{local language} specifies the communication
behaviour of participants.

\begin{definition}[Global language]\label{def:chorlang}
  A \emph{global language} (\emph{g-language} for short) is a
  prefix-closed language $\clang$ on $\alfint^\infty$ such that
  $\ptpof[\clang]$ is finite.
\end{definition}

\begin{definition}[Local language]\label{def:actlang}
  A \emph{local language} (\emph{l-language} for short) is a
  prefix-closed language $\alang$ on $\alfact$ such that 
  $\ptpof[\alang]$ is finite.
  %
  An l-language is \emph{$\p$-local} if its words have all actions
  with subject \p.
\end{definition}

%
As discussed in \cref{sec:intro}, l-languages give rise to
\emph{communicating systems}.
\begin{definition}[Communicating system]\label{def:commSyst}
  Let $\ptpset \subseteq \mathfrak{P}$ be a finite set of
  participants.
  %
  A \emph{(communicating) system over $\ptpset$} is a map
  $\aCS = (\alang_{\p})_{\p \in \ptpset}$ assigning an $\p$-local
  language $\alang_{\p}\neq \Set{\epsilon}$ such that
  $\ptpof[\alang_{\p}] \subseteq \ptpset$ to each participant
  $\p \in \ptpset$.
\end{definition}



By projecting a g-language $\clang$ on a participant $\p$ we obtain
the $\p$-local language describing the sequence of actions performed
by $\p$ in the interactions involving $\p$ in the words of $\clang$.
\begin{definition}[Projection]\label{def:projection}
  The \emph{projection on \p} of an interaction $\gint[][B][@][C]$
  is computed by the function
  $\proj{\_}{\_} : \alfint \times \mathfrak{P} \to \alfact \cup \Set{\epsilon}$ defined by:
  \[
	 \proj{(\gint[])}{A} = \aout \qquad\qquad \proj{(\gint[])}{B} =
	 \ain \qquad\qquad \proj{(\gint[])}{c} = \epsilon
  \]
  %
  and extended homomorphically to interaction words and g-languages.
  %
  The \emph{projection of a g-language $\clang$}, written
  $\proj{\clang}{}$, is the communicating system
  $(\proj{\clang}{\p})_{\p \in \ptpof[\clang]}$.
\end{definition}
\cref{def:projection} recasts in our setting the notion of projection
used, e.g., in~\cite{CarboneHY12,honda16jacm}.



\begin{example}\label{ex:simple}\hfill\\
  Let
  $\clang = \Set{\emptyword,\, \gint[][A][m][D],\,\gint[][A][m][D]\cat\gint[][C][m][B],\, 
                                               \gint[][A][m][B],\, 
                                               \gint[][C][m][B],\,
                                               \gint[][C][m][B]\cat\gint[][A][m][D]}$

  $\proj{\clang}{} = (\proj{\clang}{X})_{\ptp[X] \in
	 \Set{\p,\q,\ptp[c],\ptp[d]}}$ where\\
  $\proj{\clang}{A} = \Set{\varepsilon,\, \aout[A][D],\, \aout[A][B]}$,\\
  $\proj{\clang}{B} = \Set{\varepsilon,\, \ain[C][B]}$, \\
  $\proj{\clang}{C} = \Set{\varepsilon,\, \aout[C][B]}$, and\\
  $\proj{\clang}{D} = \Set{\varepsilon,\, \ain[A][D]}$.
  \finex
\end{example}

\begin{definition}[Split and Join]\label{def:decomp}
\begin{enumerate}[i)]
\item
  The \emph{splitting} operation
  $\ssplit[\_]: \alfint^\infty \to \alfact^\infty$ 
  is the homomorphic extension on words and sets of words of the following function on interactions. 
  \[
	 \ssplit[\gint] = \aout\cat\ain
  \]
  \item
  The \emph{joining} operation on strict synchronous words of actions 
  is the homomorphic extension on words and sets of words of the following function on interactions. 
  \[
	 \join[\aout\cat\ain] = \gint
  \]
  \end{enumerate}
\end{definition}

We define an operation filtering out in an word of action those actions  having a given subject

\begin{definition}[Filtering]\label{def:decomp}
  The \emph{filtering} operation
  $\filter{\_}{\_}: \alfact^\infty \times \mathfrak{P} \to
  \alfint^\infty$ is the homomorphic extension on words of the following function on actions. 
  \[
	 \filter{\aact}{\p} =
	 \begin{cases}
		\aact &  \text{if } \p \text{ is the subject of } \aact
		\\
		\emptyword &  \text{otherwise}
	 \end{cases}
  \]
\end{definition}

\begin{fact}
\label{fac:joinsplit}
Let $\clang$ be a c-language, $\acword\in\clang$, $\aCS$ a communicating system on $\ptpset$, $\px\in\ptpset$, and let $z\in\alfact^\infty$ such that $\ssynch[z]$
\begin{enumerate}[i)]
\item
\label{fac:joinsplit-a}
$\filter{{\ssplit[{\acword}]}}{\px} = \proj{\acword}{X}$
\item
\label{fac:joinsplit-feqp}
$\proj{\join[z]}{X} = \filter{z}{\px}$. 

\end{enumerate}
\end{fact}



\subsection{Symmetric synchronous semantics}

We consider a \emph{synchronous} semantics of
communicating systems, similarly to other choreographic approaches
such as~\cite{BravettiZ07,CarboneHY12,Dezani-Ciancaglini16,SeveriD19}.

\begin{definition}[Symmetric synchronous Semantics]\label{def:syncSem}
  Given a system $\aCS$ on $\ptpset$, the set
  \[
	 \ssem{\aCS} = \Set{\acword \in \alfint^\infty \sst  \ptpof[\acword] \subseteq \ptpset \ \land\ \forall \p \in
		\ptpset \qst \ \proj{\acword}{\p} \in \aCS(\p)}
  \]
  is the \emph{{\bf symmetric} (synchronous) semantics} of $\aCS$;
\end{definition}

\subsection{Asymmetric synchronous semantics}

In the asymmetric case we can look at a syncronous communication of the message $\msg$
from $\p$ to $\q$ as composed by two actions: the choice of $\aout$ among the possible outputs and the
handshaking communication resulting in the reception of the message by $\q$ ($\ain$).
Of course several different actions performed by participants other that $\p$ and $\q$
could occur in between $\aout$ and $\ain$. The following definition describe the words
of actions that correspond to possible runs in a system with asymmetric synchronous communincations.
 

\begin{definition}[Asymm-synch words and relations]
Let $z\in\alfact^{\infty}$. We say $z$ to be a 
\begin{enumerate}
\item
{\em  weakly synchronous word} ($\dsynch[z]$) whenever both the following conditions hold
\begin{enumerate}[a)]
\item 
for each action $\aout$ in $z$, the first action after it of the form $\p\,\_!\_$ or  $\_\,\p?\_$ (if any) is $\ain$;
\item
for each action $\ain$ in $z$, the first action preceding it of the form $\q\,\_!\_$ or  $\_\,\q?\_$ is $\aout$, and it is always the case.
\end{enumerate}
We define $WS=\Set{z\in\alfact^\infty \sst \dsynch[z]}$.
\item
The relation $\commds\ \subseteq WS{\times}WS$ is defined by:\
$z\commds z'  \quad \text{if} \quad \forall \px.\ \filter{z}{\px}=\filter{z}{\px}$
\item
 {\em strictly synchronous} $(\ssynch[z])$ whenever there exist $z'\in\alfact^{\infty}$ and 
 $\acword\in\alfint^{\infty}$ such that 
   $z'=\ssplit[w]$ and $z\commds z'$.\\
   We define $SS=\Set{z\in\alfact^\infty \sst \ssynch[z]}$.
\item
$\sqsubset\ \subseteq WS\times WS$ is defined by 
$z\sqsubset z'$ if $\ssynch[z]$ and there exists  a finite word of input actions $\iota$ such that $z = z'\setminus \iota$ 
.
\end{enumerate}
\end{definition}





The following definition of asymmetric semantics for a communicating system $\aCS$ corresponds
to the possible runs (deferred synchronous words) of  $\aCS$.



\begin{definition}[Asymmetric synchronous semantics]
 \[
	 \asem{\aCS} = \Set{z \in \alfact^\infty \sst \wsynch[z] \land\ptpof[z] \subseteq \ptpset \ \land\ \forall \p \in
		\ptpset \qst \filter{z}{\p} \in \aCS(\p)  }
  \]
  is the \emph{{\bf unrestricted asymmetric} (synchronous) semantics} of $\aCS$;
\end{definition}

Notice that we need to consider only elements of $WS$, otherwise the semantics of a system like
$\aCS = ({\alang}_{\px})_{\ptp[X] \in \Set{\p,\q}}$ where\\
\centerline{$\alang_{\p}= \Set{\aout[A][B][][m]}$ \qquad $\alang_{\q}= \Set{\ain[A][B][][m]^\omega}$ }
would contain also runs like 
$\aout[A][B][][m]\cat\ain[A][B][][m]^\omega$ or $\ain[A][B][]\cat\aout[A][B][][m]$, which are trivially nonsensical for the intended synchronous interactions.


We now notice that, in presence of infinite computations and unless strong restrictions on systems are imposed, 
identity of semantics would not be possible.
Let us consider the system
$\aCS = ({\alang}_{\px})_{\ptp[X] \in \Set{\p,\q, \ptp[C], \ptp[D]}}$ where
$$\begin{array}{ll}
\alang_{\p}= \pref[\Set{(\aout[A][B][][m])^\omega}] &
\alang_{\q}= \pref{\Set{(\ain[A][B][][m])^\omega}}  \\[2mm]
\alang_{\ptp[C]}= \Set{\emptyword, \aout[C][D][][m]} &
\alang_{\ptp[D]}= \Set{\emptyword,\ain[C][D][][m]}
\end{array}$$
We have that 
$\ssem{\aCS} = 
\Set{(\gint[][A][m][B])^h\cat\gint[][C][m][D]\cat(\gint[][A][m][B])^k \sst h,k\geq 0}\cup\pref[\Set{(\gint[][A][m][B])^\infty}]$.
Moreover, it is possible to check that 
$z = \aout[A][B][][m]\cat\aout[C][D][][m]\cat\ain[A][B][][m]\cat(\aout[A][B][][m]\cat\ain[A][B][][m])^\omega\in\gasem{\aCS}$, where $z$ is maximal in $\gasem{\aCS}$ and  $\aout[C][D][][m]$ is unmatched in $z$.
The presence of the unmatched $\aout[C][D][][m]$ in $z$ is however only due to the lack
of fairness towards the participant $\ptp[D]$, since in the semantics it is also present
a maximal $z'$ which correspond precisely to $z$ but for the presence of the matching
action for the $\aout[C][D][][m]$. More precisely, we have
that also  $z' = \aout[A][B][][m]\cat\aout[C][D][][m]\cat\ain[C][D][][m]\cat\ain[A][B][][m]\cat(\aout[A][B][][m]\cat\ain[A][B][][m])^\omega\in\gasem{\aCS}$.
It is reasonable not to take into account, when checking the equivalence, words like $z$.

We define $\unmatched[z]$ as the sets of the unmatched actions in $z$. 

A word $z\in\alfact^\infty$ is in synchronous form if any matched output is followed by
it corresponding input, with possibly some unmatched actions in between.

\begin{lemma}
Let $\aCS$ be a communicating system. For each $z\in\asem{\aCS}$ there exists
$z'\in\asem{\aCS}$ such that $z'\commds$ and $z'$ is in synchronous form. 
\end{lemma}

\begin{lemma}
\label{lem:finunm}
In each infinite $z\in \asem{\proj{\clang}{}}$ there exist only a finite number of unmatched output
actions in $z$. 
\end{lemma}
\begin{proof}[Sketch] Since $\wsynch[z]$ holds and
there is a finite number of participants in $\aCS$.\qed
\end{proof}

\begin{definition}[Fair computations]
Let $\aCS$ be a communicating system and let $z\in\alfint^\omega$ such that $z\in\asem{\aCS}$.
Moreover, let $z_1, z_2\in\alfact^\infty$ be such that $z=z_1\cat z_2$ where $\unmatched[z_2]=\emptyset$
(notice that $z_2$ exists by  \cref{lem:finunm}).
We say that $z$ is {\em unfair} for $\aCS$ if there exists 
$\aout\in\unmatched[z]$ such that\\
\centerline{
$\forall z_3.\quad (z_1\preceq z_3\prec z \land \unmatched[z_3]=\unmatched[z_1])  \implies z_3\cat\ain\in\asem{\aCS}$.} 
We say that $z$ is {\em fair} if it is not unfair. \\
Finite elements of  $\asem{\aCS}$ are always fair.
\end{definition}


\begin{definition}[Systems with equivalent semantics]
\label{def:semind}
Let $\aCS$ be a communicating system. We say that $\aCS$ is {\em (synchronous) semantics intependent}
 ($\sind[\aCS]$) whenever
 $$\text{for each maximal and fair } z\in \asem{\proj{\clang}{}}:\  \ssynch[z]$$ 
%\begin{enumerate}[a)]
%\item
%for each finite  maximal $z\in \asem{\proj{\clang}{}}$, $\ssynch[z]$; and
%\item
%for each infinite and fair $z\in \asem{\proj{\clang}{}}$,  $z\in \ssem{\proj{\clang}{}}$.
%\end{enumerate}
\end{definition}







The above unrestricted semantics could be, however, not comfortably handled.
We then restrict it to a sound subset that safely \quo{represents} it. 
The following observation is at the basis of what will shall use as the 
actual asymmetric synchronous semantics (\cref{def:syncSem} below)

Let us consider a generic trace $z$ of a system with asymmetric synchronous communication possibly
containing a number of output actions which have not been \quo{matched} yet by their corresponding
input actions. It is not difficult to see that we can rearrange the actions of $z$ in a \quo{consistent} way, in order to obtain another word belonging to the semantics and of the form
$\hat z\cat z'$, where $z'$ contains only the unmatched output and in $\hat z$ each
output is immediately followed by the corresponding input.


\begin{definition}[(prefix/strict) synchronous words]
% We say that $\aact[a]\cat\aact[b]\in\alfact^2$ is a split-pair of action
%  whenever $\aact[a]=\aout$ implies $\ain$.
%  
  A word of actions $z\in\alfact^{\infty}$ is 
  \begin{enumerate}[i)]
  \item
  {\em strictly synchronous} $(\ssynch[z])$ whenever
   $z=\ssplit[w]$ for some $\acword\in\alfint^\infty$.
  \item
  {\em prefix synchronous} $(\psynch[z])$ whenever
  \begin{description} 
  \item
  If $z\in\alfact^{*}$ then $z=z'\cat o$ where $\ssynch[z']$ and $o$ is a word of output actions;
  \item
  If $z\in\alfact^{\omega}$ then there exists a finite word $o$ of output actions  such that 
  $\ssynch[{z\setminus o}]$
  \end{description}
\end{enumerate}
  $\slang\subseteq \alfact^{\infty}$  is a \emph{strictly ({\text{resp.} prefix) synchronous} language
  of actions} (\emph{ss-(ps-)language} for short) whenever each word in $\slang$ is strictly (resp. prefix) synchronous.
  \end{definition}
  
%  We define a relation on deferred synchronous words.
%\begin{definition}[$\commds$]
%The relation $\commds\ \subseteq DS{\times}DS$ is defined by
%$$z\commds z'  \quad \text{if} \quad \forall \px.\ \filter{z}{\px}=\filter{z}{\px}$$
%\end{definition}

  
\begin{lemma}
Let be $\aCS$ a communicating system.
\begin{enumerate}[i)]
\item
Given $z\in \gasem{\aCS}$, there exists $z'\commds z$ such that $\psynch[z']$ and $z'\in \gasem{\aCS}$.
\item
$\gasem{\aCS}$ is $\commds$-closed.
\end{enumerate}
\end{lemma}
 
We can hence safely provide a more manageable definition of asymmetric synchronous semantics. 
\begin{definition}[Asymmetric synchronous Semantics]\label{def:syncSem}
  Given a system $\aCS$ on $\ptpset$, the set
  \[
	 \asem{\aCS} = \Set{z \in \alfact^\infty \sst \ptpof[z] \subseteq \ptpset \ \land\ \psynch[z]\  \land\ \forall \p \in
		\ptpset \qst \filter{z}{\p} \in \aCS(\p)  }
  \]
  is the \emph{{\bf asymmetric} (synchronous) semantics} of $\aCS$;
\end{definition}

\begin{lemma}
Let $\aCS$ be a system on $\ptpset$.
$$\gasem{\aCS} = \Set{z\in\alfact^\infty \sst  \psynch[z] \land \exists z'\in\asem{\aCS}.\  z\commds z'}$$ 
\end{lemma}

[say that the two semantics are a g- and an s-language, that is they are prefix-closed]

\begin{lemma}
\label{fac:asymmsubsymm}
Let  $\aCS$ be a communicating system on $\ptpset$.
\begin{enumerate}[i)]
\item
$\ssem{\aCS} =  
\Set{\acword \in \alfint^\infty \sst  
\ptpof[\acword] \subseteq \ptpset \ \land\ \forall \p \in \ptpset \qst \filter{\ssplit[\acword]}{\p} \in \aCS(\p)}$.
\item
\label{fac:asymmsubsymm-aimps}
$z\in\asem{\aCS}$ and $\ssynch[z]$ implies $\join[z]\in\ssem{\aCS}$.
\item
\label{fac:asymmsubsymm-asubs}
$\pref[{\ssplit[{\ssem{\aCS}}]}] \subseteq \asem{\aCS}$.
\end{enumerate}
\end{lemma}

\begin{example}
\label{ex:simple2}
The two semantics are trivially non equivalent in general on communicating systems.
Let us consider $\aCS = ({\alang}_{\px})_{\ptp[X] \in \Set{\p,\q}}$ where\\
\centerline{$\alang_{\p}= \Set{\aout[A][B][][m], \aout[A][B][][y]}$ \qquad $\alang_{\q}= \Set{\ain[A][B][][m]}$ }
is clearly lock-free with the symmetric semantics and non lock-free with the asymmetric one.

 Even in case we consider systems
obtained by projecting a CUI \sclang the two semantics can differ. 
Let us consider the \sclang $\clang$ in \cref{ex:simple}.
$\clang$ is CUI, hence we have 
  $$\ssem{\proj{\clang}{}} = \clang$$ 
whereas 
  $$\asem{\proj{\clang}{}} = \ssplit[\clang] \cup \pref[\Set{\aout[A][B][][m]\cat\ain[A][B][][m]\cat\aout[C][B][][m]}]$$
\finex
\end{example} 

\begin{definition}[Asymm-synchronous correctness and completeness]\label{def:cc}
  Let $\aCS$ be a communicating system and $\clang$ a g-language.\\
  $\aCS$ is \emph{a-synch correct (resp. complete) with respect to
    $\clang$} if $\join[{\asem{\aCS}}]\subseteq \clang$ (resp. 
  $\join[{\asem{\aCS}}]\supseteq \clang$).
\end{definition}


\begin{definition}[CUIasym]
\label{def:cuiasym}
A c-language $\clang$ on $\ptpset$ is CUIasym $(\cuuiasym[\clang])$ whenever,
 for each $\p,\q,\ptp[C]$,$\msg[m]$,$\msg[n]$, and each $\acword, \acword_1\in\clang$, the following holds:
 \begin{enumerate}[a)]
 \item For no $\acword$ there exists $\acword\cat\gint[][A][m][B]$, $\acword\cat\gint[][B][n][C]$
 and $\acword\cat\gint[][C][x][A]$. In general, a cycle. [Generalise for a cycle of arbitrary length].
  \item
  \label{def:cuiasym-I}
$\proj{\acword}{A} = \proj{\acword_1}{A}\ \land\  \acword_1\cat\gint\in\clang\ \implies\ \acword\cat\gint\in\clang$; and
  \item[ALT b]
\label{def:cuiasym-I}
 there exists $\acword'$ such that 
  $\acword\cat \acword'\cat\gint[][A][n][B]\cat\gint \in\clang$
  where $\p\not\in\ptpof[\acword']$

$\proj{\acword}{A} = \proj{\acword_1}{A}\ \land\  \acword_1\cat\gint\in\clang\ \implies\ \acword\cat\gint\in\clang$; and
 \item
 $\acword\cat\gint\in\clang\ \land\ \acword\cat\gint[][B][n][C]\in\clang\   \implies\
 \acword\cat\gint[][B][n][C]\cat\gint,\, \acword\cat\gint\cat\gint[][B][n][C]\in\clang$.
 \item[ALT c)]
  $\acword\cat\gint\in\clang\ \land\ \acword\cat\gint[][B][n][C]\in\clang\   \implies\ $
  \begin{itemize}
  \item
  for each maximal extension $\acword'$ of $\acword\cat\gint$ there exists
  $\acword\cat\gint\cat \acword'' \cat\gint[][B][n][C]\preceq \acword'$
  such that $\p\not\in\ptpof[\acword'']$; and
    \item
  for each maximal extension $\acword'$ of $\acword\cat\gint[][B][n][C]$ there exists
  $\acword\cat\gint[][B][n][C]\cat \acword'' \cat\gint\preceq \acword'$
  such that $\q\not\in\ptpof[\acword'']$.
  \end{itemize}
   \item[ALT2 c)]
  $\acword\cat\gint\in\clang\ \land\ \acword\cat\gint[][B][n][C]\in\clang\   \implies\ $
  there exist $\acword'$ and $\acword''$ such that 
  $\acword\cat \acword'\cat\gint[][B][n][C]\cat\acword''\cat\gint \in\clang$
  where $\p\not\in\ptpof[\acword'\cat\acword'']$ and $\q\not\in\ptpof[\acword']$,
\end{enumerate}
\end{definition}

\begin{proposition}
Let $\clang$ be a g-language.\\
\centerline{$\cuuiasym[{\clang}]\ \implies\ \cuui[\clang]$}
\end{proposition}
\begin{proof}
Let us assume $\cuuiasym[{\clang}]$ to hold. In order to show  $\cuui[{\clang}]$, 
by definition let us consider $\acword_1,\acword_2,\acword\in\clang$, $\p,\q,\msg$ such that
$$\proj{\acword}{A} =\proj{\acword_1}{A}\quad \proj{\acword}{B} =\proj{\acword_1}{B}
\quad \acword_1\cat\gint, \acword_2\cat\gint\in\clang$$
From $\proj{\acword}{A} =\proj{\acword_1}{A}$ and $\acword_1\cat\gint\in\clang$,
by $\cuuiasym[{\clang}]$ we immediately get  $\acword\cat\gint\in\clang$, that is what we needed to
prove $\cuui[\clang]$.
\qed
\end{proof}


\begin{theorem}[Equivalence of semantics]
\label{th:eqsem}
 Let $\clang$ be a CUI \sclang\!.
$$
\cuuiasym[\clang] \quad \text{iff}\quad \sind[\proj{\clang}{}]
%\asem{\proj{\clang}{}} =  \pref[{\ssplit[\ssem{\proj{\clang}{}}]}]\quad (= \pref[{\ssplit[\clang]}]\text{ by } \cuui)
$$
\end{theorem}
\begin{proof}
%
{\bf ($\Leftarrow$)}.
%
By contraposition, let us assume $\cuuiasym[\clang]$ not to hold. 
By \cref{def:cuiasym}, we have hence to consider the following two cases.\\ 
$\bullet$ 
There exists $\p,\q\in\ptpset$ and $\acword, \acword_1\in\clang$ such that
\begin{itemize}
\item
$ \proj{\acword}{A} = \proj{\acword_1}{A}$
\item
$\acword_1\cat\gint\in\clang$
\item
 $\forall \acword'.\  \q\not\in\ptpof[\acword'] \implies \acword\cat\acword'\cat\gint\not\in\clang$.
 \end{itemize}
 This necessarily implies $\acword_1\neq\acword$.
We now observe that, by definition of projection, trivially,
 $\proj{(\acword_1\cat\gint)}{A}\in{\proj{\clang}{A}}$.
 So, using  Fact \ref{fac:joinsplit}(\ref{fac:joinsplit-a}) and the above, we have that
 $\proj{(\acword_1\cat\gint)}{A}
= \proj{\acword_1}{A}\cat\aout[A][B][][m]
= \proj{\acword}{A}\cat\aout[A][B][][m]
 = \filter{(\ssplit[{\acword}])}{\p}\cat\aout[A][B][][m]
 = \filter{(\ssplit[{\acword}]\cat\aout[A][B][][m])}{\p}
 \in{\proj{\clang}{A}}$.
 Now, by  definitions of projection, filtering and by Fact \ref{fac:joinsplit}(\ref{fac:joinsplit-a}) we have that, for each $\px\neq\p$, $\filter{(\ssplit[{\acword}]\cat\aout[A][B][][m])}{\px}=\filter{\ssplit[{\acword}]}{\px}=\proj{{\acword}}{\px}\in\proj{\clang}{X}$.
So, by definition of $\asem{\proj{\clang}{}}$ and by observing that, trivially,
$\wsynch[{\ssplit[{\acword}]\cat\aout[A][B][][m]}]$, we get 
 $$\ssplit[{\acword}]\cat\aout[A][B][][m]\in\asem{\proj{\clang}{}}.$$
By contradiction, let us assume $\sind[\clang]$ to hold.
This implies that, since  $\neg\ssynch[{\ssplit[{\acword}]\cat\aout[A][B][][m]}]$.
We can hence  take a $u\in\alfact^\infty$ such that $\ssplit[{\acword}]\cat\aout[A][B][][m]\cat u$
is maximal and fair in $\asem{\clang}$, for which then the condition of  \cref{def:semind} is satisfied,
that is $\ssynch[{\ssplit[{\acword}]\cat\aout[A][B][][m]\cat u}]$.
So, for suitable $u_1$ and $u_2$,  
$$
\ssplit[{\acword}]\cat\aout[A][B][][m]\cat u= \ssplit[{\acword}]\cat\aout[A][B][][m]\cat u_1\cat\ain[A][B][][m]\cat u_2$$
Moreover, from $\wsynch[{\ssplit[{\acword}]\cat\aout[A][B][][m]\cat u_1\cat\ain[A][B][][m]\cat u_2}]$ we get that
$\p\not\in\ptpof[u_1]$.
Now, since it is possible to postpone an output till its corresponding input, we have that
$$\ssplit[{\acword}]\cat\aout[A][B][][m]\cat u_1\cat\ain[A][B][][m]\cat u_2\commds \hat u$$
 where 
$$\hat u=\ssplit[{\acword\cat\acword_1\cat\gint[][A][m][B]\cat\acword_2}]$$ for suitable
 $\acword_1,\acword_2\in\alfint^\infty$,
  where $\p\not\in\ptpof[\acword_1]$, so contradicting  the third item of our assumption.
 
%
%We distinguish between the two possible cases.
%%
%\begin{description}
%%
%\item
%$\ssplit[{\acword}]\cat\aout[A][B][][m]\cat u$ is finite.\\
%%
% \cref{def:semind} implies that, in such a case,   
%
%Such an $u'$ should have necessarily the form $u'=\ain[A][B][][m]\cat u''$.
% This, together with prefix closure of $\asem{\proj{\clang}{}}$
% and \cref{fac:asymmsubsymm}(\ref{fac:asymmsubsymm-aimps}), would imply
%$\join[{\ssplit[{\acword}]\cat\aout[A][B][][m]\cat \ain[A][B][][m]}]\in\ssem{\proj{\clang}{}}$,
%that is $\acword\cat\gint\in\ssem{\proj{\clang}{}}$ and hence, by $\cuui$,
%$\acword\cat\gint\in{{\clang}}$, contradicting the third conjunct of (\ref{eq:lahyp}).
%%
%\item
%$\ssplit[{\acword}]\cat\aout[A][B][][m]\cat u$ is infinite.....................\\ 
%\end{description}
$\bullet$ There exists $\acword\in\clang$ such that 
\begin{itemize}
\item
$\acword\cat\gint\in\clang$
\item
$\acword\cat\gint[][B][n][C]\in\clang$
\item
$\forall \acword', \acword''.\  (\p\not\in\ptpof[\acword'\cat\acword''] \land \q\not\in\ptpof[\acword']) \implies \acword\cat\acword'\cat\gint[][B][n][C]\cat\acword''\cat\gint\not\in\clang$.
 \end{itemize}
Now, by definition of $\asem{\_}$
we have that $\ssplit[\acword]\cat\aout[A][B][][m]\cat\aout[B][C][][m]\in\asem{\proj{\clang}{}}$.
By contradiction, let us assume $\sind[\clang]$ to hold.
Let us now take a generic fair and maximal extension  of $\ssplit[\acword]\cat\aout[A][B][][m]\cat\aout[B][C][][n]$
in $\asem{\proj{\clang}{}}$, say  $\ssplit[\acword]\cat\aout[A][B][][m]\cat\aout[B][C][][n]\cat u$. We distinguish between the two possible cases.
\begin{description}
\item
$\ssplit[\acword]\cat\aout[A][B][][m]\cat\aout[B][C][][n]\cat u$ is finite.\\
Since we assumed $\sind[\proj{\clang}{}]$, we have that 
$\ssynch[{\acword\cat\aout[A][B][][m]\cat\aout[B][C][][n]\cat u}]$.
This means  $\ssplit[\acword]\cat\aout[A][B][][m]\cat\aout[B][C][][n]\cat u$  to be actually
of the form  
$$\ssplit[\acword]\cat\aout[A][B][][m]\cat\aout[B][C][][n]\cat u_1\cat\ain[B][C][][n]\cat u_2\cat\ain[A][B][][m]\cat u_3$$
for suitables $u_1$, $u_2$ and $u_3$.
We remark that $\ssplit[\acword]\cat\aout[A][B][][m]\cat\aout[B][C][][n]\cat u$  cannot be
of the form  $$\ssplit[\acword]\cat\aout[A][B][][m]\cat\aout[B][C][][n]\cat u_1\cat\ain[A][B][][m]\cat u_2\cat\ain[B][C][][n]\cat u_3$$
because $\wsynch[{\ssplit[\acword]\cat\aout[A][B][][m]\cat\aout[B][C][][n]\cat u}]$ needs to hold.\\
Moreover, from $\wsynch[{\ssplit[\acword]\cat\aout[A][B][][m]\cat\aout[B][C][][n]\cat u_1\cat\ain[B][C][][n]\cat u_2\cat\ain[A][B][][m]\cat u_3}]$ we get that
$\p\not\in\ptpof[u_1\cat u_2]$ and $\q\not\in\ptpof[u_1]$.
Now, since it is possible to postpone an output till its corresponding input, we have that
$$\ssplit[\acword]\cat\aout[A][B][][m]\cat\aout[B][C][][n]\cat u_1\cat\ain[B][C][][n]\cat u_2\cat\ain[A][B][][m]\commds \hat u$$
 where 
$$\hat u=\ssplit[{\acword\cat\acword_1\cat\gint[][B][n][C]\cat\acword_2\cat\gint[][A][m][B]\cat\acword_3}]$$ for suitable
 $\acword_1,\acword_2,\acword_3\in\alfint^\infty$,
  where $\p\not\in\ptpof[\acword_1\cat\acword_2]$ and $\q\not\in\ptpof[\acword_1]$.
 
 We have than that $\acword\cat\acword_1\cat\gint[][B][n][C]\cat\acword_2\cat\gint[][A][m][B]\in\clang$ and $\acword\cat\acword_1\cat\gint[][B][n][C]\cat\acword_2\in\clang$ and
 $$\proj{\acword\cat\acword_1\cat\gint[][B][n][C]\cat\acword_2}{A}
 =
 \proj{\acword\cat\acword_1\cat\gint[][B][n][C]}{A}
 $$
 Since we are assuming condition (\ref{def:cuiasym-I}) of \cref{def:cuiasym}
 (otherwise the first case would apply), we can infer that there exists $\acword''$ such that
 $$\acword\cat\acword_1\cat\gint[][B][n][C]\cat\acword''\cat\gint[][A][m][B]\in\clang$$
 where $\p\not\in\ptpof[\acword_1\cat\acword'']$ and $\q\not\in\ptpof[\acword_1]$, so contradicting the third item of our assumption.
 
 
%
% 
% 
% 
%
%We can consider the first case, since the second one is similar.
%We show now that actually  both
%$$\acword\cat\aout[A][B][][m]\cat\aout[B][C][][n]\cat u_1\cat\ain[A][B][][m]\cat u_2\cat\ain[B][C][][n]\cat u_3
%\commds 
%\acword\cat\aout[A][B][][m]\cat\ain[A][B][][m]\cat\aout[B][C][][n]\cat\ain[B][C][][n]\cat u_1\cat u_2\cat u_3$$
%and
%$$\acword\cat\aout[A][B][][m]\cat\aout[B][C][][n]\cat u_1\cat\ain[A][B][][m]\cat u_2\cat\ain[B][C][][n]\cat u_3
%\commds 
%\acword\cat\aout[B][C][][n]\cat\ain[B][C][][n]\cat\aout[A][B][][m]\cat\ain[A][B][][m]\cat u_1\cat u_2\cat u_3$$
%belongs to $\asem{\proj{\clang}{}}$, contradicting our hypothesis.
%In order to do that, we show that, if $u_1=u'_1\cat\aact$, 
% $$
% \acword\cat\aout[A][B][][m]\cat\aout[B][C][][n]\cat u_1\cat\ain[A][B][][m]\cat u_2\cat\ain[B][C][][n]\cat u_3
% \commds
% \acword\cat\aout[A][B][][m]\cat\aout[B][C][][n]\cat u'_1\cat\ain[A][B][][m]\cat\aact\cat u_2\cat\ain[B][C][][n]\cat u_3$$
% [and similarly for $u_2$ with $\ain[B][C][][n]$]
 

\end{description}


%
 {\bf ($\Rightarrow$)}.
 %
 We assume $\cuuiasym$. Now, to show the thesis by contradiction, we assume 
 $\asem{\proj{\clang}{}}$ not to be equivalent to $\ssem{\proj{\clang}{}}$.
 In such a case, by \cref{fac:asymmsubsymm}( \ref{fac:asymmsubsymm-asubs}),
two following holds.
\begin{quote}
There exists a maximal and fair $z\in \asem{\proj{\clang}{}}$ such that  $\neg\ssynch[z]$.
\end{quote}

 By Lemma XXX, since $\neg\ssynch[z]$ and $\wsynch[z]$, and we assumed $\cuuiasym$, there exists 
 $z'\in\asem{\proj{\clang}{}}$ such that 
 $$z\commds z' = \hat z \cat\aout[B_0][B_1][][m_1]\cat\aout[B_1][B_2][][m_2]\ldots\cat\aout[B_{n-1}][B_n][][m_n]\cat o$$
  where
  \begin{itemize}
  \item
 $\hat z = \ssplit[\acword]$ for a certain $\acword\in\alfint^*$; and 
 \item 
 $\aout[B_0][B_1][][m_1]\cat\aout[B_1][B_2][][m_2]\ldots\cat\aout[B_{n-1}][B_n][][m_n]\cat o$ is the sequence
 of the unmatched 
 output action in $z$; and
 \item
 no sender in $o$ belongs to $\Set{\ptp[B_i] \sst 0\leq i \leq n}$; and
 \item
 $\Set{\aout[D_j][B_n][][n_J] \sst 0\leq i \leq k}$ is the set of actions in $o$ having $\ptp[B_n]$ 
 as receiver. 
 \end{itemize}  
 Notice that, by Lemma YYY, also $z'$ is maximal in $\asem{\proj{\clang}{}}$.\\





===========================

 \begin{enumerate}[a)]
 \item
 \label{lab:finite}
 There exists $z\in \asem{\proj{\clang}{}}$ such that $z\in \alfact^*$, $z$ is maximal in 
 $\asem{\proj{\clang}{}}$ and $\neg\ssynch[z]$.
 \item
  \label{lab:infinite}
   $z\in \ssem{\proj{\clang}{}}$.
 There exits $z\in \asem{\proj{\clang}{}}$ such that $z$ is infinite, fair and $\neg\ssynch[z]$.
 \end{enumerate}
 We show now how to proceed towards a contradiction in both of the above cases.
 %
 \begin{description}
 \item[ \ref{lab:finite})]
 %
 By Lemma XXX, since $\neg\ssynch[z]$ and $\psynch[z]$ there exists 
 $z'\in\asem{\proj{\clang}{}}$ such that 
 $$z\commds z' = \hat z \cat\aout[B_0][B_1][][m_1]\cat\aout[B_1][B_2][][m_2]\ldots\cat\aout[B_{n-1}][B_n][][m_n]\cat o$$
  where
  \begin{itemize}
  \item
 $\hat z = \ssplit[\acword]$ for a certain $\acword\in\alfint^*$; and 
 \item 
 $\aout[B_0][B_1][][m_1]\cat\aout[B_1][B_2][][m_2]\ldots\cat\aout[B_{n-1}][B_n][][m_n]\cat o$ is the sequence
 of the unmatched 
 output action in $z$; and
 \item
 no sender in $o$ is $\ptp[B_n]$.
 \end{itemize}  
 Notice that, by Lemma YYY, also $z'$ is maximal in $\asem{\proj{\clang}{}}$.\\
 %
%$\bullet$
% ${\aout[B][C][][n]\not\in o}$ for no participant $\ptp[C]$ and message $\msg[n]$.(REMOVE?)\\
% %
%  By definition of $\asem{\proj{\clang}{}}$, 
%for each $\px\in\ptpof[\hat z\cat\aout\cat o]$  there is a $z_{\px}\in\proj{\clang}{X}$ such that
%$\filter{(\hat z\cat\aout\cat o)}{\px}=z_{\px}$. In particular, $z_{\p}= \filter{\hat z}{\p}\cat\aout$ and,
%for  $\px\neq\p$, $z_{\px} = \filter{\hat z}{\px}\cat  \filter{o}{\px}$.
%Now, by definition of projection,  for each $\px\in\ptpof[z]$ we can set $\acword_{\px}\in\clang$
%as a word such that  $\proj{\acword_{\px}}{X}= z_{\px}$. 
%Since $z_{\p}= \filter{\hat z}{\p}\cat\aout$, we can infer that  
%$\acword_{\p}= \acword_1\cat\gint$ for some $\acword_1\in\clang$ such that
%$\proj{\acword_1}{A}= \filter{\hat z}{\p}$. 
%
%
% We now observe that  $\asem{\proj{\clang}{}}$ is prefix closed, 
%so $\hat z\in \asem{\proj{\clang}{}}$. 
%Hence, by $ \ssynch[\hat z]$ and  
%\cref{fac:asymmsubsymm}(\ref{fac:asymmsubsymm-aimps}), 
%$\join[\hat z]\in\ssem{\proj{\clang}{}}$. Then,
%since $\clang$ is CUI, we get $\join[\hat z]\in\clang$. 
%Moreover, by Fact \ref{fac:joinsplit}(\ref{fac:joinsplit-feqp}) for each $\px$,
%$\proj{\join[\hat z]}{X}=\filter{\hat z}{\px}$. 
%
%
%
%
%Now, by setting $\acword=\join[\hat z]$, by the above
%we have that
%\begin{itemize}
%\item
%$\proj{\acword_1}{A} = \proj{\acword}{A}$\qquad 
%(since $\proj{\acword_1}{A}=\filter{\hat z}{\p}=\proj{\join[\hat z]}{A}=\proj{\acword}{A}$)
%\item
%$\acword_1\cat\gint\in\clang$
%\end{itemize} 
%So, by $\cuuiasym[\clang]$, $\acword\cat\gint=\join[\hat z]\cat\gint\in\clang$. 
%We notice now that 
%$\proj{(\acword\cat\gint)}{B} = 
%  \proj{(\join[\hat z]\cat\gint)}{B} =
%  \filter{(\hat z\cat\ain)}{\q}$.
%Moreover, since $\aout\cat o$ is a sequence of unmatched  output action
%such that ${\aout[B][C][][n]\not\in o}$ for no participant $\ptp[C]$ and message $\msg[n]$,
%we get that  $\filter{(\hat z\cat\ain)}{\q} = \filter{(\hat z\cat\aout\cat o\cat\ain)}{\q}$.
%So, from what previously inferred and the above, we can obtain
%\begin{itemize}
%\item
%$ \filter{(\hat z\cat\aout\cat o\cat \ain)}{\p}= \filter{(\hat z\cat\aout\cat o)}{\p} = z_{\p}\in\proj{\clang}{A}$
%\item
%$ \filter{(\hat z\cat\aout\cat o\cat\ain)}{\q} = \filter{(\hat z\cat \ain)}{\p} = \proj{(\acword\cat\gint)}{B}\in\proj{\clang}{B}$
%\item
%$ \filter{(\hat z\cat\aout\cat o\cat\ain)}{\px} =  \filter{(\hat z\cat o)}{\px}  = z_{\px}\in\proj{\clang}{X}
%\qquad \text{for } \px\not\in\Set{\p,\q}$.
%\end{itemize}
%So, by definition of $\asem{\proj{\clang}{}}$, we get $\hat z\cat\aout\cat o\cat\ain\in\asem{\proj{\clang}{}}$, contradicting the maximality of $\hat z\cat\aout\cat o$.\\
%
%
%
%
$\bullet$

 %
 By definition of $\asem{\proj{\clang}{}}$, 
for each 
$\px\in\ptpof[{z'}]$  there is a $z_{\px}\in\proj{\clang}{X}$ such that
$\filter{z'}{\px}=z_{\px}$. So, trivially, by definition of projections,
for each $\px\in\ptpof[z']$  there is a $\acword_{\px}\in{\clang}$ such that
$\filter{z'}{\px}=\proj{\acword_{\px}}{X}$.\\
 In particular,
 since $z'=\hat z \cat\aout[B_0][B_1][][m_1]\cat\aout[B_1][B_2][][m_2]\ldots\cat\aout[B_{n-1}][B_n][][m_n]\cat o$, and no two actions in $\aout[B_0][B_1][][m_1]\cat\aout[B_1][B_2][][m_2]\ldots\cat\aout[B_{n-1}][B_n][][m_n]\cat o$ can have the same sender (Lemma VVV), we have that 
  $$
   \proj{\acword_{\ptp[B_{i}]}}{B_{i}}= \filter{\hat z}{\ptp[B_{i}]}\cat\aout[B_{i}][B_{i+1}][][m_{i+1}]
  \quad \text{\small ( $0\leq i \leq n-1$)}$$
  and
  $$\proj{\acword_{\px}}{X} = \filter{\hat z}{\px}\cat  \filter{o}{\px} \qquad 
   \text{\small ( $\px\not\in\Set{\q_i \sst 0\leq i\leq n-1}$)}$$
From the above  we can infer that  
$$
\acword_{\ptp[B_{i}]} = \acword'_{\ptp[B_{i}]}\cat \gint[][{B_i}][m_{i+1}][{B_{i+1}}]
 \quad \text{\small ($0\leq i \leq n-1$)}
$$
      for some $\acword'_{\ptp[B_{i}]} \in\clang$ ($1\leq i \leq n-1$) such that
$$
 \proj{\acword'_{\ptp[B_{i}]}}{B_i}= \filter{\hat z}{\ptp[B_{i}]}  \qquad \text{\small ($0\leq i \leq n-1$)} $$

 We now observe that  $\asem{\proj{\clang}{}}$ is prefix closed, 
so $\hat z\in \asem{\proj{\clang}{}}$. 
Hence, since $\hat z = \ssplit[\acword]$ for a certain $\acword\in\alfint^*$ and by  
\cref{fac:asymmsubsymm}(\ref{fac:asymmsubsymm-aimps}), we have that
$\acword=\join[\hat z]\in\ssem{\proj{\clang}{}}$. Then,
since $\clang$ is CUI, we get $\join[\hat z]\in\clang$. 
Moreover, by Fact \ref{fac:joinsplit}(\ref{fac:joinsplit-feqp}), for each $\px$,
$\proj{\join[\hat z]}{X}=\filter{\hat z}{\px}$. 


So, by the above, we have that
\begin{itemize}
\item
$\acword'_{\ptp[B_{i}]}\cat\gint[][B_i][m_{i+1}][B_{i+1}]\in\clang$   \qquad  
     {\small  ($0\leq i \leq n-1$)} 
\item
$\proj{\acword'_{\ptp[B_{i}]}}{B_i} = \proj{\acword}{B_i}$\quad 
{\small (since $\proj{\acword'_{\ptp[B_{i}]}}{B}=\filter{\hat z}{\ptp[B_{i}]}=\proj{\join[\hat z]}{B_i}=\proj{\acword}{B}$) \quad ($0\leq i \leq n-1$) }
\end{itemize} 
So, by $\cuuiasym[\clang]$,  [CONSIDER alternative CUIasym]
$$\acword\cat\gint[][B_i][m_{i+1}][{B_{i+1}}]
\in\clang$$
for each $0\leq i \leq n-1$,
and
$$\acword\cat\gint[][B_{i-1}][m_{i}][{B_{i}}]\cat \gint[][{B_{i}}][m_{i-1}][B_{i-1}],\,%\cat\ldots \cat\gint[][B_{n-1}][m_{n}][B_{n}]
\acword\cat \gint[][{B_{i}}][m_{i-1}][B_{i-1}]\cat\gint[][B_{i-1}][m_{i}][{B_{i}}]%\cat\ldots \cat\gint[][B_{n-1}][m_{n}][B_{n}]
\in\clang$$
for each $1\leq i \leq n$.

We notice now that, since $\wsynch[z']$ holds, so does $\wsynch[{z'\cat\ain[B_{n-1}][B_n][][m_n] \cat\ain[B_{n-2}][B_{n-1}][][m_1]\ldots\cat\ain[B_0][B_1][][m_1]}]$. Moreover,
\begin{itemize}
\item
$ \filter{(z'\cat\ain[B_{n-1}][B_n][][m_n] \cat\ain[B_{n-2}][B_{n-1}][][m_1]\ldots\cat\ain[B_0][B_1][][m_1])}{\ptp[{B_0}]}= \filter{\hat z}{\ptp[B_0]}\cat\aout[B_0][B_1][][m_1] = \proj{\acword_{\ptp[B_0]}}{B_0}\in\proj{\clang}{B_0}$
\item
$ \filter{(z'\cat \ain[B_{n-1}][B_n][][m_n] \cat\ain[B_{n-2}][B_{n-1}][][m_1]\ldots\cat\ain[B_0][B_1][][m_1])}{\ptp[B_i]}$\\ 
$= \filter{\hat z}{\ptp[B_i]}\cat \aout[B_i][B_{i+1}][][m_{i+1}]\cat\ain[B_{i-1}][B_{i}][][m_{i}]$\\ 
$= \proj{\acword'_{\ptp[B_{i}]}}{B_{i}}\cat \aout[B_i][B_{i+1}][][m_{i+1}]\cat\ain[B_{i-1}][B_{i}][][m_{i}] $  \\
$= \proj{\acword}{B_{i}}\cat \aout[B_i][B_{i+1}][][m_{i+1}]\cat\ain[B_{i-1}][B_{i}][][m_{i}] $  \\
$=\proj{(\acword\cat\gint[][B_{i}][m_{i+1}][B_{i+1}]\cat\gint[][B_{i-1}][m_i][B_i])}{B_i}\in\proj{\clang}{B_i}$

(since, as previously shown, \\
$\proj{\acword_{\ptp[B_{i}]}}{B_{i}}= \filter{\hat z}{\ptp[B_{i}]}\cat\aout[B_{i}][B_{i+1}][][m_{i+1}]$ 
and $\proj{\acword'_{\ptp[B_{i}]}}{B_i} = \proj{\acword}{B_i}$
and $\acword\cat \gint[][{B_{i+1}}][m_{i}][B_i]\cat\gint[][B_i][m_{i+1}][{B_{i+1}}]\in\clang$)
%\item
%$ \filter{(\hat z\cat\aout\cat o\cat\ain\cat \ain[B][C][][n])}{\ptp[C]} =  \filter{(\hat z\cat o\cat \ain[B][C][][n])}{\ptp[C]}  = \proj{(\acword\cat\gint[][B][n][C]\cat\gint)}{C}\in\proj{\clang}{C}$
%\item
%$ \filter{(\hat z\cat\aout\cat o\cat\ain\cat \ain[B][C][][n])}{\px} =  \filter{(\hat z\cat o)}{\px}  = z_{\px}\in\proj{\clang}{X}
%\qquad \text{for } \px\not\in\Set{\p,\q,\ptp[C]}$
\item
$ \filter{(z'\cat \ain[B_{n-1}][B_n][][m_n] \cat\ain[B_{n-2}][B_{n-1}][][m_1]\ldots\cat\ain[B_0][B_1][][m_1])}{\ptp[{X}]}
= \filter{\hat z}{\ptp[X]} \filter{o}{\ptp[X]} 
= \proj{\acword_{\px}}{X} \in\proj{\clang}{X}$\\
   $\text{\footnotesize ( $\px\not\in\Set{\q_i \sst 0\leq i\leq n-1}$)}$
\end{itemize}
So, by definition of $\asem{\proj{\clang}{}}$, we get $z'\cat \ain[B_{n-1}][B_n][][m_n] \cat\ain[B_{n-2}][B_{n-1}][][m_1]\ldots\cat\ain[B_0][B_1][][m_1]\in\asem{\proj{\clang}{}}$, contradicting the maximality of $z'$.\\



%$\bullet$ (SECOND VERSION)
%
% %
% By definition of $\asem{\proj{\clang}{}}$, 
%for each 
%$\px\in\ptpof[{z'}]$  there is a $z_{\px}\in\proj{\clang}{X}$ such that
%$\filter{z'}{\px}=z_{\px}$. So, trivially, by definition of projections,
%for each $\px\in\ptpof[z']$  there is a $\acword_{\px}\in{\clang}$ such that
%$\filter{z'}{\px}=\proj{\acword_{\px}}{X}$.\\
% In particular,
% since $z'=\hat z \cat\aout[B_0][B_1][][m_1]\cat\aout[B_1][B_2][][m_2]\ldots\cat\aout[B_{n-1}][B_n][][m_n]\cat o$, and no two actions in $\aout[B_0][B_1][][m_1]\cat\aout[B_1][B_2][][m_2]\ldots\cat\aout[B_{n-1}][B_n][][m_n]\cat o$ can have the same sender (Lemma VVV), we have that 
%  $$%\proj{\acword_{\p}}{A}= \filter{\hat z}{\p}\cat\aout  \qquad \qquad
%   \proj{\acword_{\ptp[B_{i}]}}{B_{i}}= \filter{\hat z}{\ptp[B_{i}]}\cat\aout[B_{i}][B_{i+1}][][m_{i+1}]
%  \quad \text{\small ( $0\leq i \leq n-1$)}$$
%  and
%  $$\proj{\acword_{\px}}{X} = \filter{\hat z}{\px}\cat  \filter{o}{\px} \qquad 
%   \text{\small ( $\px\not\in\Set{\q_i \sst 0\leq i\leq n-1}$)}$$
%From the above  we can infer that  
%$$%\acword_{\p}= \acword'_{\p}\cat\gint[][A][m_{1}][{B_{1}}] \qquad
%\acword_{\ptp[B_{i}]} = \acword'_{\ptp[B_{i}]}\cat \gint[][{B_i}][m_{i+1}][{B_{i+1}}]
% \quad \text{\small ($0\leq i \leq n-1$)}
%$$
%      for some $\acword'_{\p},\acword'_{\ptp[B_{i}]} \in\clang$ ($1\leq i \leq n-1$) such that
%$$%\proj{\acword'_{\p}}{A}= \filter{\hat z}{\p} \text{ and } 
% \proj{\acword_{\ptp[B_{i}]}}{B_i}= \filter{\hat z}{\ptp[B_{i}]}  \qquad \text{\small ($0\leq i \leq n-1$)} $$
%
% We now observe that  $\asem{\proj{\clang}{}}$ is prefix closed, 
%so $\hat z\in \asem{\proj{\clang}{}}$. 
%Hence, by $ \ssynch[\hat z]$ and  
%\cref{fac:asymmsubsymm}(\ref{fac:asymmsubsymm-aimps}), 
%$\join[\hat z]\in\ssem{\proj{\clang}{}}$. Then,
%since $\clang$ is CUI, we get $\join[\hat z]\in\clang$. 
%Moreover, by Fact \ref{fac:joinsplit}(\ref{fac:joinsplit-feqp}), for each $\px$,
%$\proj{\join[\hat z]}{X}=\filter{\hat z}{\px}$. 
%
%
%
%
%Now, by setting $\acword=\join[\hat z]$, and by the above,
%we have that
%\begin{itemize}
%%\item
%%$\acword'_{\p}\cat\gint[][A][m_{1}][{B_{1}}]\in\clang$
%\item
%$\acword'_{\ptp[B_{n-1}]}\cat\gint[][B_{n-1}][m_{n}][B_{n}]\in\clang$  
%     \item
%$\acword'_{\ptp[B_{n-2}]}\cat\gint[][B_{n-2}][m_{n-1}][B_{n-1}]\in\clang$   \qquad  
%     {\small  ($0\leq i \leq n-1$)} 
%%\item
%%$\proj{\acword'_{\p}}{A} = \proj{\acword}{A}$\qquad 
%%(since $\proj{\acword'_{\p}}{A}=\filter{\hat z}{\p}=\proj{\join[\hat z]}{A}=\proj{\acword}{A}$)
%\item
%$\proj{\acword'_{\ptp[B_{n-1}]}}{B_{n-1}} = \proj{\acword}{B_{n-1}}$\quad 
%{\small (since $\proj{\acword'_{\ptp[B_{n-1}]}}{B_{n-1}}=\filter{\hat z}{\ptp[B_{n-1}]}=\proj{\join[\hat z]}{B_{n-1}}=\proj{\acword}{B_n-2}$)}
%\item
%$\proj{\acword'_{\ptp[B_{n-2}]}}{B_{n-2}} = \proj{\acword}{B_{n-2}}$\quad 
%{\small (since $\proj{\acword'_{\ptp[B_{n-2}]}}{B_{n-2}}=\filter{\hat z}{\ptp[B_{n-2}]}=\proj{\join[\hat z]}{B_{n-2}}=\proj{\acword}{B_{n-2}}$)}
%\end{itemize} 
%We also observe that, for no $\acword''$, $\ptp[D]$ and $\msg[n]$,
%we have that  $\acword''\cat \gint[][{B_{i+1}}][n][D]\in\clang$ and 
%$\proj{\acword''}{B_{i+1}}= \proj{\acword}{B_{i+1}}$, otherwise
%we would get $\hat z \cat\aout[B_0][B_1][][m_1]\cat\aout[B_1][B_2][][m_2]\ldots\cat\aout[B_{n-1}][B_n][][m_n]\cat \gint[][{B_{i+1}}][n][D]\cat o\in\clang$, which is not possible.
%
%So, by $\cuuiasym[\clang]$,  
%$$\acword\cat\gint[][B_{n-1}][m_{n}][{B_{n}}]\cat \gint[][{B_{n-2}}][m_{n-1}][B_{n-1}],\,
%\acword\cat\gint[][{B_{n-2}}][m_{n-1}][B_{n-1}]\cat \gint[][B_{n-1}][m_{n}][{B_{n}}]
%\in\clang$$
%
%We notice now that 
%%$\proj{(\acword\cat\gint)}{B} = 
%%  \proj{(\join[\hat z]\cat\gint)}{B} =
%%  \filter{(\hat z\cat\ain)}{\q}$.
%%Moreover, since $\aout\cat o$ is a sequence of unmatched  output action
%%such that ${\aout[B][C][][n]\in o}$ for some participant $\ptp[C]$ and message $\msg[n]$, we can obtain
%
%\begin{itemize}
%\item
%$ \filter{(z'\cat \ain[B_0][B_1][][m_1]\cat\ain[B_1][B_2][][m_2]\ldots\cat\ain[B_{n-1}][B_n][][m_n])}{\p}= \filter{\hat z}{\p}\cat\aout[B_0][B_1][][m_1] = \proj{\acword_{\ptp[B_0]}}{B_0}\in\proj{\clang}{B_0}$
%\item
%$ \filter{(z'\cat \ain[A][B_1][][m_1]\cat\ain[B_1][B_2][][m_2]\ldots\cat\ain[B_{n-1}][B_n][][m_n])}{\ptp[B_i]}$\\ 
%$= \filter{\hat z}{\ptp[B_i]}\cat \aout[B_i][B_{i+1}][][m_{i+1}]\cat\ain[B_{i-1}][B_{i}][][m_{i}] =$\\ 
%$= \proj{\acword'_{\ptp[B_{i}]}}{B_{i}}\cat \aout[B_i][B_{i+1}][][m_{i+1}]\cat\ain[B_{i-1}][B_{i}][][m_{i}] $  \\
%$=\proj{(\acword\cat\gint[][B_{i}][m_{i+1}][B_{i+1}]\cat\gint[][B_{i-1}][m_i][B_i])}{B_i}\in\proj{\clang}{B_i}$
%
%since, as previously shown, \\
%$\proj{\acword_{\ptp[B_{i}]}}{B_{i}}= \filter{\hat z}{\ptp[B_{i}]}\cat\aout[B_{i}][B_{i+1}][][m_{i+1}]$ 
%and $\proj{\acword'_{\ptp[B_{i}]}}{B_i} = \proj{\acword}{B_i}$
%and $\acword\cat \gint[][{B_{i+1}}][m_{i}][B_i]\cat\gint[][B_i][m_{i+1}][{B_{i+1}}]\in\clang$
%%\item
%%$ \filter{(\hat z\cat\aout\cat o\cat\ain\cat \ain[B][C][][n])}{\ptp[C]} =  \filter{(\hat z\cat o\cat \ain[B][C][][n])}{\ptp[C]}  = \proj{(\acword\cat\gint[][B][n][C]\cat\gint)}{C}\in\proj{\clang}{C}$
%%\item
%%$ \filter{(\hat z\cat\aout\cat o\cat\ain\cat \ain[B][C][][n])}{\px} =  \filter{(\hat z\cat o)}{\px}  = z_{\px}\in\proj{\clang}{X}
%%\qquad \text{for } \px\not\in\Set{\p,\q,\ptp[C]}$
%\end{itemize}
%So, by definition of $\asem{\proj{\clang}{}}$, we get $\hat z\cat\aout\cat o\cat\ain\in\asem{\proj{\clang}{}}$, contradicting the maximality of $z'=\hat z\cat\aout\cat o$.\\
%
%
\item[ \ref{lab:infinite})]
%
We can safely consider $z$ in synchronous form.
Let now
$z_1, z_2\in\alfact^\infty$ be such that $z=z_1\cat z_2$  where $\unmatched[z_1]=\emptyset$
(we recall that $z_1$ exists since $\wsynch[z]$ holds and
there is a finite number of participants in $\aCS$),
and let $z_3$ be any word of actions such that  
$z_1\preceq z_3\prec z$ and $\unmatched[z']=\unmatched[z_1]$
By Lemma XXX, 
 $$z_3\commds z' = \hat z \cat\aout[B_0][B_1][][m_1]\cat\aout[B_1][B_2][][m_2]\ldots\cat\aout[B_{n-1}][B_n][][m_n]\cat o$$
  where
  \begin{itemize}
  \item
 $\hat z = \ssplit[\acword]$ for a certain $\acword\in\alfint^*$; and 
 \item 
 $\aout[B_0][B_1][][m_1]\cat\aout[B_1][B_2][][m_2]\ldots\cat\aout[B_{n-1}][B_n][][m_n]\cat o$ 
 contains all the unmatched  output actions in $z$; and
 \item
 no sender in $o$ is $\ptp[B_n]$.
 \end{itemize}  

We can now proceed as done in the case (\ref{lab:finite}), obtaining

$z'\cat \ain[B_{n-1}][B_n][][m_n] \cat\ain[B_{n-2}][B_{n-1}][][m_1]\ldots\cat\ain[B_0][B_1][][m_1]\in\asem{\proj{\clang}{}}$ and hence
$z_3\cat \ain[B_{n-1}][B_n][][m_n] \cat\ain[B_{n-2}][B_{n-1}][][m_1]\ldots\cat\ain[B_0][B_1][][m_1]\in\asem{\proj{\clang}{}}$. So, by prefix closure, $z_3\cat \ain[B_{n-1}][B_n][][m_n]\in\asem{\proj{\clang}{}}$,
contradicting the fairness of $z$, since we considered a generic $z_3$ such that
 $z_1\preceq z_3\prec z$ and $\unmatched[z_3]=\unmatched[z_1]$. 
\qed
 \end{description}
\end{proof} 
% \begin{equation}
% \label{eq:aneqs}
% \asem{\proj{\clang}{}} \neq  \pref[{\ssplit[\ssem{\proj{\clang}{}}]}].
% \end{equation}
% Since, by \cref{fac:asymmsubsymm}( \ref{fac:asymmsubsymm-asubs}),
% $\pref[{\ssplit[{\ssem{\proj{\clang}{}}}]}] \subseteq \asem{\proj{\clang}{}}$
% we have that our assumption (\ref{eq:aneqs}) correspond to 
% $\asem{\proj{\clang}{}}\not\subseteq \pref[{\ssplit[{\ssem{\proj{\clang}{}}}]}]$.
% By \cref{fac:asymmsubsymm}(\ref{fac:asymmsubsymm-aimps}) this in turn corresponds to
% asserting that the set 
% $$
% I = \Set{z\in\asem{\proj{\clang}{}} \sst \neg\ssynch[{z}] \land 
% \forall \hat\acword\in\ssem{\proj{\clang}{}}.\ z\not\preceq \ssplit[{\hat w}]}$$
% is non empty.
% 
% This implies that, for certain $\hat z \in\alfact^*$ and $\p,\q,\msg[m]$, $z$ is of the form $z=\hat z\cat\aout$ and such that
% \begin{equation}
% \label{eq:negass}
%% \exists \hat z \in\alfact^\infty \ssynch[\hat z]\ \land\ \exists \p,\q,\msg[m].\  \hat z\cat\aout \in \asem{\proj{\clang}{}} \land\  
% \join[{\hat z\cat\aout\cat\ain}]\not\in\ssem{\proj{\clang}{}}
% \end{equation}
% In fact, if we had  $\join[{\hat z\cat\aout\cat\ain}]\in\ssem{\proj{\clang}{}}$
% we would also have $\join[{\hat z\cat\aout\cat\ain}]\in\ssem{\proj{\clang}{}}$
% 
% 
% By definition of $\asem{\proj{\clang}{}}$, 
%for each $\px\in\ptpof[\hat z\cat\aout]$  there is a $z_{\px}\in\proj{\clang}{X}$ such that
%$\filter{(\hat z\cat\aout)}{\px}=z_{\px}$. In particular, $z_{\p}= \filter{\hat z}{\p}\cat\aout$ and,
%for  $\px\neq\p$, $\filter{\hat z}{\px}=z_{\px}$.
%Now, by definition of projection,  for each $\px\in\ptpof[z]$ we can set $\acword_{\px}\in\clang$
%as a word such that  $\proj{\acword_{\px}}{X}= z_{\px}$. 
%Since $z_{\p}= \filter{\hat z}{\p}\cat\aout$, we can infer that  
%$\acword_{\p}= \acword_1\cat\gint$ for some $\acword_1\in\clang$ such that
%$\proj{\acword_1}{A}= \filter{\hat z}{\p}$. 
% 
% We now observe that  $\asem{\proj{\clang}{}}$ is prefix closed, 
%so $\hat z\in \asem{\proj{\clang}{}}$. 
%Hence, by $ \ssynch[\hat z]$ and  
%\cref{fac:asymmsubsymm}(\ref{fac:asymmsubsymm-aimps}), 
%$\join[\hat z]\in\ssem{\proj{\clang}{}}$. Then,
%since $\clang$ is CUI, we get $\join[\hat z]\in\clang$. 
%Moreover, by Fact \ref{fac:joinsplit}(\ref{fac:joinsplit-feqp}) for each $\px$,
%$\proj{\join[\hat z]}{X}=\filter{\hat z}{\px}$. 
%We now proceed by noticing that $\acword_1\neq\join[\hat z]$. In fact, otherwise, we would have $\join[\hat z]\cat\gint\in\clang$
%and hence, by $\cuui$, 
%${\join[\hat z]}\cat\gint\in\ssem{\proj{\clang}{}}$, 
%that is $\join[{\hat z\cat\aout\cat\ain}]\in\ssem{\proj{\clang}{}}$,
%contradicting the third conjunct of our assumption (\ref{eq:negass}).\\
% Now, by setting $\acword=\join[\hat z]$, by the above
%we have that
%\begin{itemize}
%\item
%$\proj{\acword_1}{A} = \proj{\acword}{A}$\qquad 
%(since $\proj{\acword_1}{A}=\filter{\hat z}{\p}=\proj{\join[\hat z]}{A}=\acword$)
%%\item 
%%$\proj{\acword_2}{B} = \proj{\acword}{B}$
%\item
%$\acword_1\cat\gint\in\clang$
%\end{itemize} 
%So, by $\cuuiasym[\clang]$, $\acword\cat\gint=\join[\hat z]\cat\gint\in\clang$. 
%This, as previously shown, would imply  $\join[{\hat z\cat\aout\cat\ain}]\in\ssem{\proj{\clang}{}}$ that contradicts the third conjunct of (\ref{eq:negass}).
%\qed

 
 \begin{example}
In \cref{ex:simple2} we have seen that the two synchronous semantics differ on the \sclang 
$\clang$ of \cref{ex:simple}.
In fact it is possible to show that $\cuuiasym[{\clang}]$ does to hold.
By taking $\acword_1=\gint[][A][m][D]$ and $\acword=\gint[][A][m][B]$, we have that
$$\proj{\acword_1}{C}=\emptyword = \proj{\acword}{C} \quad\text{ and }\quad \acword_1\cat\gint[][C][m][B]\in\clang$$
However $\gint[][A][m][B]\cat\cat\gint[][C][m][B]= \acword\cat\cat\gint[][C][m][B]\not\in\clang$.
\finex
\end{example}

 
 It is easy to show that in the  characterization of \cref{th:eqsem}  one cannot get rid of the CUI hypothesis.
 In fact, for $\clang=\Set{\gint[][A][m][B], \gint[][C][m][D]}$, the two semantics are
 trivially equivalent on $\proj{\clang}{}$ and $\cuui[\clang]$ does not hold.
 In any case, a chracterisation of the equivalence for c-languages that could be non CUI,
 would hardly be of any use.
 

 
% ========================
% 
%By definition of semantics (\cref{def:syncSem}), it is enough to show that 
%the set
%$$
%Y = \Set{\hat u   \sst \ssynch[\hat u]\ \land\ \exists \p,\q,\msg[m].\  \hat u\cat\aout \in \asem{\proj{\clang}{}} \land\  \join[{\hat u\cat\aout\cat\ain}]\in\ssem{\proj{\clang}{}} }
%$$
%is empty.
%By contradiction let us assume $Y$ not to be empty.
%We can then take a word $\hat z\in Y$, namely such that $\ssynch[\hat z]$,
%$\hat z\cat\aout\in \asem{\proj{\clang}{}}$ but $\hat z\cat\aout\cat\ain\not\in\asem{\proj{\clang}{}}$.
%By definition of $\asem{\proj{\clang}{}}$, 
%for each $\px\in\ptpof[\hat z\cat\aout]\subseteq\ptpset$  there is a $z_{\px}\in\proj{\clang}{X}\cap\alfact^*$ such that
%$\filter{(\hat z\cat\aout)}{\px}=z_{\px}$. In particular, $z_{\p}= \hat z'_{\p}\cat\aout$ 
%for some $\hat z'_{\p}$ and, if $\px\neq\p$, $\filter{\hat z}{\px}=z_{\px}$.
%Now, by definition of projection,  for each $\px\in\ptpof[z]$ we can set $\acword_{\px}\in\clang$
%as a word such that  $\proj{\acword_{\px}}{X}= z_{\px}$. 
%Since $z_{\p}= \hat z'_{\p}\cat\aout$, we can infer that  
%$\acword_{\p}= \acword_1\cat\gint$ for some $\acword_1\in\clang$ such that
%$\proj{\acword_1}{A}= \hat z'_{\p}$. 
%
%We now observe that  $\asem{\proj{\clang}{}}$ is prefix closed, 
%so $\hat z\in \asem{\proj{\clang}{}}$. 
%Hence, by Fact \ref{fac:asymmsubsymm}, $\join[\hat z]\in\ssem{\proj{\clang}{}}$ and then,
%since $\clang$ is CUI, we get $\join[\hat z]\in\clang$. 
%Moreover, for $\px\neq\p$,
%$\proj{\join[\hat z]}{X}=\filter{\hat z]}{\px}$. 
%%So, in particular $\proj{\join[\hat z]}{B}=\filter{\hat z}{\q}=z_{\q}=\proj{\acword_{\q}}{B}$.
%We notice that $\acword_1\neq\join[\hat z]$. In fact, otherwise, we would have $\join[\hat z]\cat\gint\in\clang$
%and hence, by $\cuui$ and Fact \ref{fac:asymmsubsymm}, $\ssplit[{{\join[\hat z]}\cat\gint}]\in\asem{\proj{\clang}{}}$, that is $\hat z\cat\aout\cat\ain\in\asem{\proj{\clang}{}}$,
%contradicting what we had assumed. 
%
%
%
%
%Now, by setting $\acword=\join[\hat z]$ % and $\acword_2=\acword_{\q}$
%we have that
%\begin{itemize}
%\item
%$\proj{\acword_1}{A} = \proj{\acword}{A}$
%%\item 
%%$\proj{\acword_2}{B} = \proj{\acword}{B}$
%\item
%$\acword_1\cat\gint\in\clang$
%\end{itemize} 
%So, by CUI2, $\acword\cat\gint\in\clang$. 
%This, as shown above, would imply by definition implies $\hat z\cat\aout\cat\ain\in\asem{\proj{\clang}{}}$, so contradicting that $\hat z\in Y$.
%\qed
%
%Let us now consider $\hat z=\aact[a]_0\cat\ldots\cat\aact[a]_{n-1}$. By definition it follows that
%$\hat z \in \ssem{\proj{\clang}{}}$. 
%Moreover, for each $\px\in\ptpof[z]\subseteq\ptpset$  there is a
%subsequence $z_{\px}$ of $\hat z$ of the form $\aact[a]_{j_{\px}0}\cat\ldots\cat\aact[a]_{j_{\px}m_{\px}}$ belonging to $\proj{\clang}{X}$ such that $\hat z \in \shuffle_{\ptpof[z]}z_{\px}$.
%
%For each $\px\in\ptpof[z]$ let now $\acword_{\px}\in\clang$ be a word such that $\proj{\acword}{X}= z_{\px}$. 
%By definition of projection it follows that $\acword_{\p}$ has the form $\acword'\cat\gint$ 
%for some $\acword'$.
%By Lemma XXX 
% This immediately implies that $\acword_{\q}$ has the form $\acword''\cat\gint$ for some $\acword''$.
% 
% 
%
%Let now be $\acword = \acword_1\cat\gint$ the word in \\
%$(\subseteq)$



\begin{corollary}
Let $\clang$ be a CUIasym g-language. Then $\proj{\clang}{}$ is a-synch correct and complete for $\clang$.
\end{corollary}


It is now possible to show that if we consider the calculus of MultiParty Sessions of [DezaniSeveri]
(restricted to sequential reductions), on any system obtained by projecting a well-formed 
global types the two synchronous semantics are equivalent.


\begin{proposition}
For each global type ${\mathsf G}$,\\
\centerline{${\mathsf G}$ well-formed\ $\implies$\ $\cuuiasym[{\clang({\mathsf G})}]$.}
\end{proposition}

\begin{proof}
Let ${\mathsf G}$ be well-formed.
By contradiction, let us assume $\cuuiasym[{\clang({\mathsf G})}]$ not to hold.
This means that there exist $\acword_1,\acword\in\clang({\mathsf G})$ such that, for a certain
interaction $\gint$,
$$
\proj{\acword_1}{A} = \proj{\acword}{A}      \qquad      \acword_1\cat\gint\in\clang({\mathsf G})   
\qquad \acword\cat\gint\not\in\clang({\mathsf G})
$$
By well-formedness, each continuation of $\acword$ must contain an interaction with participant $\p$.
Let us then consider $\acword$ with one of its  continuation that is a word of the form
$$
\acword\cat\acword'\cat \aint \qquad \text{where } \p\in\ptpof[\aint] \quad \text{and }\proj{\acword'}{A}=\emptyword
$$
Now, since each participant has to distinguish each pair of maximal branches by two inputs,
we have necessarily that $\aint=\gint$. Moreover, since  $\proj{\acword'}{A}=\emptyword$,
also $\acword\cat \aint\cat\acword'\in\clang({\mathsf G}) $, contradicting our assumption
$\acword\cat\gint\not\in\clang({\mathsf G})$
\qed
\end{proof}


%\begin{proposition}[FALSE]
%Let $\clang$ be a  g-language. 
%$$\cuuiasym[\clang] \implies ba[\clang]$$
%\end{proposition}
%\begin{proof}
%Let us assume $\cuuiasym[\clang]$. By contradiction, let us assume also $ba[\clang]$ not to hold.
%So, by definition, we have two maximal words $\acword_1, \acword_2\in\clang$ and a participant
%$\p$ such that $\proj{\acword_1}{A}\prec \proj{\acword_2}{A}$.
%Let now $\hat\acword_1$ and $\hat\acword_2$ be the longest prefixes of, respectively
%$\acword_1$ and  $\acword_2$ such that $\proj{\hat\acword_1}{A}= \proj{\hat\acword_2}{A}$.
%Since $\proj{\acword_1}{A}\prec \proj{\acword_2}{A}$ there exists a prefix of $\acword_2$ 
%of the form $\hat\acword_2\hat\acword'_2\cat\gint$, 
%where $\proj{\hat\acword'_2}{A}=\emptyword$. 
%Since $\proj{\hat\acword_2\hat\acword'_2}{A}=\proj{\hat\acword_1}{A}$
%\end{proof}

\subsection{Asym-synch communication properties}

\begin{definition}[Harmonicity]

\end{definition}

\begin{lemma}
For any g-language $\clang$, $\proj{\clang}{}$ is harmonic.
\end{lemma}
\begin{proof}
By \cref{fac:asymmsubsymm}(\ref{fac:asymmsubsymm-asubs}),
$\pref[{\ssplit[{\ssem{\proj{\clang}{}}}]}] \subseteq \asem{\proj{\clang}{}}$.
Since $\clang\subseteq \ssem{\proj{\clang}{}}$, 
$\ssplit[\clang]\subseteq \asem{\proj{\clang}{}}$ and hermonicity of $\proj{\clang}{}$ 
as a consequence.
\end{proof}

Deadlock freedom cannot be formalised as in the case of sym-synch communications.
Trivially, let us consider the following system, made of a single participant.
 $\aCS=  ({\alang}_{\px})_{\ptp[X] \in\Set{\p,\q}}$ where
$\alang_{\p}= \Set{\aout[A][B][][m]}$ and $\alang_{\q}= \Set{\emptyword}$.
We have that $\aout[A][B][][m]$ is finite and maximal in $\asem{\aCS}$. Moreover,
for each participant $\px\in\Set{\p,\q}$, $\filter{(\aout[A][B][][m])}{\px}$ is maximal in
$\aCS(\px)$.

\begin{definition}[Asym-synch DF]
Let $\aCS$ be an asym-synch communicating systems on $\ptpset$.
$\aCS$ is {\em asym-synch deadlock free} whenever for each finite maximal 
$z\in\asem{\aCS}$ the following conditions hold
\begin{itemize}
\item
$\neg\ssynch[z]$;
\item
for each $\px\in\ptpset$, $\filter{z}{\px}$ is maximal in $\aCS(\px)$.
\end{itemize}
\end{definition}

%We then get the following corollary of \cref{th:eqsem}.
%
%\begin{corollary}[FALSE]
%Let $\clang$ be a \sclang. \\
%\centerline{
%$\cuuiasym[\clang]$ implies $\clang$ is asym-synch deadlock free.}
%\end{corollary}


\begin{lemma}
\begin{enumerate}[i)]
\item
$\ba[\clang] \implies \cuuiasym[\clang]$
\item
$\ba[\clang] \implies \text{asym-synch-DF}(\proj{\clang}{})$
\end{enumerate}
\end{lemma}
By contraposition


asym-synch-DF($\clang$) $\not\implies \cuuiasym[\clang]$:\\NO!\\
$\aCS=  ({\alang}_{\px})_{\ptp[X] \in\Set{\p,\q}}$ where\\
$\alang_{\p}= \Set{(\aout[A][B][][m])^\omega}$ 
\qquad $\alang_{\q}= \Set{(\ain[A][B][][m])^\omega}$
\qquad $\alang_{\ptp[C]}= \Set{\aout[C][B][][m]}$.\\


$\cuuiasym[\clang]$  $\not\implies$ asym-synch-DF($\clang$):\\NO!\\
 $\aCS=  ({\alang}_{\px})_{\ptp[X] \in\Set{\p,\q}}$ where
$\alang_{\p}= \Set{\ain[A][B][][m]}$ and $\alang_{\q}= \Set{\emptyword}$.\\
This example also shows that BA($\clang$)  $\not\implies$ asym-synch-DF($\clang$).



Two interactions $\aint$ and $\aint[b]$ are \emph{independent} (in
symbols $\intpar$)
when % their sets of participants are disjoint, namely
$\ptpof[\aint] \cap \ptpof[{\aint[b]}] = \emptyset$.
%
Informally, a g-language is \emph{concurrency closed} when
\quo{independent} interactions can be swapped.
%
The concurrency closure on infinite words is delicate.
%
One in fact has to allow infinitely many swaps while avoiding that
they make an interaction disappear by \quo{pushing it infinitely
  down}.
%
Technically, we consider Mazurkiewicz's traces~\cite{maz86} on
$\alfint$ with independence relation $\intpar$:
\begin{definition}[Concurrency closure]\label{def:cc}
  Let $\comm$ be the reflexive and transitive closure of the relation
  $\equiv$ on finite interaction words defined by
  $\acword\,\aint\,\aint[b]\,\acword' \equiv
  \acword\,\aint[b]\,\aint\,\acword'$ where $\intpar$.
  %
  Following \emph{\cite[Def. 2.1]{Gastin90}}, $\comm$ extends to
  $\alfint^\omega$ by letting $\acword,\acword'\in\alfint^\omega$ and defining
  \[
	 \acword \comm\acword' \quad\iff\quad \acword \ll\acword' \qand \acword' \ll\acword
  \]
  %
  where
  $\acword \ll \acword'$ iff for each finite prefix $\acword_1$ of
  $\acword$ there are a finite prefix $\acword_1'$ of $\acword'$ and a
  g-word $\hat \acword \in \alfint^\star$ such that
  $\acword_1 \cat \hat \acword \comm \acword_1'$.
  %
  A g-language $\clang$ is \emph{concurrency closed} (c-closed for
  short) if it coincides with its concurrency closure, namely
  $\clang = \Set{\acword \in \alfint^\infty \sst \exists
	 \acword'\in\clang \qst \acword \comm \acword'}$.
\end{definition}

Semantics of systems are naturally c-closed since in a distributed setting
independent events can occur in any order.
%
Indeed
\begin{toappendix}
The relation $\comm$ can be characterised as follows.
  \begin{lemma}\label{lemma:equalProj}
  Given a g-language $\clang$ and two words
  $\acword_1, \acword_2 \in \clang$, $\acword_1 \comm \acword_2$ iff
  $\proj{\acword_1}{\p} = \proj{\acword_2}{\p}$ for each
  $\p \in \ptpof[\clang]$.
\end{lemma}
%\equalProj*
\end{toappendix}
\begin{appendixproof}
  This follows directly from~\cite[Proposition 2.2]{Gastin90}.
  \qed
\end{appendixproof}

\begin{restatable}{proposition}{ccsem}\label{prop:par}
  Let $\aCS$ be a system. Then $\ssem{\aCS}$ is
  c-closed.
\end{restatable}
\begin{toappendix}
  \ccsem*
\end{toappendix}
\begin{appendixproof}
  Trivial, since closure under swap does not change the projection by
  \cref{lemma:equalProj}.
  \qed
\end{appendixproof}

% \paragraph*{The ($\proj{(\_)}{}$,$\ssem{\_}$) Galois connection\footnote{We thank an anonymous referee for the introduction of this paragraph.}}



%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% TeX-master: "main"
%%% TeX-master: "main"
%%% End:
